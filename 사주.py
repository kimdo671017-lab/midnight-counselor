import streamlit as st
import textwrap  # <--- 이 친구가 텍스트 줄맞춤을 예쁘게 해결해 줍니다.
import random
import time
import datetime

# ==============================================
# [기본 설정]
# ==============================================
st.set_page_config(
    page_title="새벽 2시 상담소",
    page_icon="🌙",
    layout="centered"
)

# 스타일 부분 수정
st.markdown("""
    <style>
    /* 1. 스트림릿 표준 다크 최적화 배경 설정 */
    /* 배경이 회색으로 뜨는 걸 막기 위해 가장 안정적인 다크 hex값(#0E1117) 기반으로 네 밤색을 맞췄어 */
    .stApp, [data-testid="stSidebar"], [data-testid="stHeader"], .st-emotion-cache-6qob1r {
        background-color: #0E1117 !important;
    }

    /* 2. 글자색 및 폰트 (어느 환경에서도 가독성이 유지되는 밝은 회색) */
    .main, p, span, label, [data-testid="stWidgetLabel"] p {
        color: #FAFAFA !important;
        font-family: 'Pretendard', sans-serif !important;
    }
    
    /* 3. 리포트 본문 설정 (네 원본 수치 유지) */
    .report-content {
        font-size: 1.05rem !important; 
        line-height: 2.1 !important; 
        color: #E0E0E0 !important; 
        word-break: keep-all !important; 
        white-space: pre-wrap !important; 
        margin-bottom: 40px !important;
        letter-spacing: -0.02em !important;
        text-align: justify !important;
    }
    
    /* 4. 카드 디자인 (배포 환경에서 가장 선명하게 보이는 다크 카드색) */
    .report-card {
        padding: 30px !important; 
        background-color: #161B22 !important; 
        border-radius: 15px !important;
        border: 1px solid #30363D !important;
        margin-bottom: 20px !important;
    }
    
    /* 5. 섹션 제목 및 키워드 태그 */
    .report-title {
        font-size: 1.5rem !important;
        font-weight: 800 !important;
        color: #FFFFFF !important;
        margin-bottom: 20px !important;
    }
    .keyword-box { text-align: center !important; margin-bottom: 50px !important; padding-bottom: 20px !important; }
    .keyword-tag {
        display: inline-block !important; padding: 8px 16px !important; margin: 4px !important;
        background-color: #21262D !important; color: #C9D1D9 !important;
        border-radius: 20px !important; font-size: 0.95rem !important; font-weight: 600 !important;
    }
    
    /* 6. 강조 하이라이트 및 조언 박스 */
    .highlight {
        background: linear-gradient(to top, rgba(88, 51, 238, 0.3) 40%, transparent 40%) !important;
        color: #FFFFFF !important; font-weight: 800 !important; padding: 0 2px !important; border-radius: 2px !important;
    }
    .advice-box {
        background-color: #0D1117 !important; border-radius: 8px !important; padding: 40px !important;
        margin-top: 60px !important; margin-bottom: 40px !important;
        color: #C9D1D9 !important; border-left: 4px solid #5833EE !important;
    }

    /* 7. 버튼 디자인 (네가 고른 보라색 #4527a0이 가장 선명하게 보이는 코드) */
    .stButton>button { 
        width: 100% !important; border-radius: 12px !important; height: 4.5em !important; 
        font-weight: 700 !important; font-size: 1.1rem !important;
        background-color: #4527a0 !important; border: none !important; color: #ffffff !important; 
        transition: 0.3s !important;
    }
    .stButton>button:hover { 
        background-color: #5e35b1 !important; color: #ffffff !important;
    }

    /* 입력창 라벨 색상 */
    label, .stMarkdown p {
        color: #e0e0e0 !important;

    /* 8. 마무리 멘트 */
    .closing-text {
        text-align: center !important; color: #8B949E !important;
        font-size: 0.95rem !important; margin-top: 80px !important; margin-bottom: 60px !important; letter-spacing: 1px !important;
    }

    .stButton>button { 
        width: 100%; border-radius: 12px; height: 4.5em; font-weight: 700; font-size: 1.1rem;
        background-color: #212529; border: none; color: #ffffff; transition: 0.3s;
    }
    .stButton>button:hover { background-color: #495057; color: #ffffff; }

    </style>
    """, unsafe_allow_html=True)

# ==============================================
# [핵심 로직 1] 절기 계산
# ==============================================
def calculate_saju_pillars(year, month, day):
    GAN = list("갑을병정무기경신임계")
    JI = list("자축인묘진사오미신유술해")
    
    base_date = datetime.date(1900, 1, 1)
    target_date = datetime.date(year, month, day)
    days_diff = (target_date - base_date).days
    
    day_gan_idx = days_diff % 10
    day_ji_idx = (days_diff + 10) % 12
    day_pillar = GAN[day_gan_idx] + JI[day_ji_idx]
    
    term_days = {1:6, 2:4, 3:6, 4:5, 5:6, 6:6, 7:7, 8:8, 9:8, 10:8, 11:7, 12:7}
    is_after_term = day >= term_days[month]
    
    saju_month_idx = -1 
    if month == 1:
        if is_after_term: saju_month_idx = 11
        else: saju_month_idx = 10
    elif month == 2:
        if is_after_term: saju_month_idx = 0
        else: saju_month_idx = 11
    else:
        base_ji_idx = month 
        if not is_after_term:
            base_ji_idx -= 1
        saju_month_idx = base_ji_idx
        if saju_month_idx >= 12: saju_month_idx %= 12

    month_ji = JI[saju_month_idx] 
    
    saju_year = year
    if month == 1 or (month == 2 and not is_after_term):
        saju_year -= 1
        
    year_gan_idx = (saju_year - 4) % 10
    year_ji_idx = (saju_year - 4) % 12
    year_pillar = GAN[year_gan_idx] + JI[year_ji_idx]
    
    month_head_idx = (year_gan_idx % 5) * 2 + 2
    if month_head_idx >= 10: month_head_idx -= 10
    
    current_month_offset = (saju_month_idx - 2) 
    if current_month_offset < 0: current_month_offset += 12
    
    month_gan_idx = (month_head_idx + current_month_offset) % 10
    month_pillar = GAN[month_gan_idx] + month_ji

    return {
        "year_pillar": year_pillar,
        "month_pillar": month_pillar,
        "day_pillar": day_pillar,
        "day_gan_idx": day_gan_idx,
        "day_ji_idx": day_ji_idx,   
        "month_ji_idx": saju_month_idx 
    }

# ==============================================
# [핵심 로직 2] 사주 데이터 (문법 오류 수정 완료)
# ==============================================
def get_saju_analysis(date_obj):
    pillars = calculate_saju_pillars(date_obj.year, date_obj.month, date_obj.day)
    stem_idx = pillars['day_gan_idx']
    branch_idx = pillars['day_ji_idx'] 
    month_idx = pillars['month_ji_idx']

    ilji_traits = {
        0: "겉으론 쿨해 보여도 속으론 생각이 꼬리에 꼬리를 무는 '자(子)수'의 예민함이 숨어있어. 밤이 되면 감수성이 폭발하고, 남들은 모르는 너만의 은밀한 비밀이 있지.",
        1: "우직하게 참다가 한 번에 터트리는 '축(丑)토'의 고집이 있어. 남들은 네 속을 절대 몰라. 겉으론 '네네' 해도 속으론 '두고 보자' 하며 칼을 갈고 있을지도.",
        2: "가만히 있지 못하고 뭔가를 저질러야 직성이 풀리는 '인(寅)목'의 역마살이 있어. 실행력 하나는 끝내주지만, 마무리가 약해서 벌려놓은 일 수습하느라 바쁘지?",
        3: "예민하고 꾸미는 걸 좋아하는 '묘(卯)목'의 도화살이 있어. 낯가리는 척하면서 은근히 사람들의 관심을 즐기고, 내 구역이 침범당하는 걸 끔찍하게 싫어해.",
        4: "현실보다 이상을 좇는 '진(辰)토'의 기질이 있어. 꿈이 크고 자존심도 하늘을 찌르지. 남들이 '그게 되겠어?'라고 해도 너는 '난 달라'라고 생각하잖아.",
        5: "화려하고 말 잘하는 '사(巳)화'의 매력이 있어. 겉은 차가워 보여도 속은 용광로처럼 뜨거워. 질투심과 소유욕이 강해서 내 사람은 확실하게 챙기지.",
        6: "화끈하고 뒤끝 없는 '오(午)화'의 열정이 있어. 좋으면 앞뒤 안 가리고 달려들지만, 식는 것도 빨라. 비밀을 담아두지 못하고 다 말해버려야 직성이 풀리지.",
        7: "순해 보이지만 똥고집인 '미(未)토'의 기질이 있어. 평소엔 다 받아주는 척하지만, 결정적인 순간엔 절대 양보 안 해. 희생정신이 강해서 남 챙기느라 바빠.",
        8: "재주 많고 눈치 빠른 '신(申)금'의 센스가 있어. 머리가 비상해서 상황 파악이 빠르지만, 끈기가 부족해서 싫증도 잘 내. 외로움을 유독 많이 타는 편이야.",
        9: "칼같이 맺고 끊는 '유(酉)금'의 완벽주의가 있어. 너의 예민함은 너를 지키는 무기야. 더러운 꼴 못 보고, 아닌 건 죽어도 아니라고 말해야 해.",
        10: "한번 믿으면 끝까지 가는 '술(戌)토'의 의리가 있어. 충직하지만, 한번 배신당하면 지옥 끝까지 쫓아가서 물어뜯는 무서운 면도 있지. 솔직해서 손해 보는 타입.",
        11: "낙천적인 척하지만 머릿속으로 계산 다 끝낸 '해(亥)수'의 지혜가 있어. 겉모습에 속으면 안 되는 타입 1위. 직감이 발달해서 촉이 무섭게 좋아."
    }
    my_branch_trait = ilji_traits[branch_idx]

    wolji_traits = {
        0: "한겨울(자월)에 태어난 너는 '정신적인 가치'를 중요하게 생각해. 남들보다 생각이 깊고 철학적이라, 겉으로 드러나는 화려함보단 내면의 안정이 더 중요하지. 연구, 기획, 혹은 밤에 하는 일이 잘 어울려.",
        1: "늦겨울(축월)의 너는 '인내심의 화신'이야. 꽁꽁 언 땅을 뚫고 나오려는 씨앗처럼, 힘든 상황에서도 묵묵히 버티며 결국엔 결과를 만들어내지. 부동산이나 전문 자격증 관련 일이 딱이야.",
        2: "초봄(인월)의 너는 '새로운 시작'을 두려워하지 않아. 호기심이 많고 기획력이 뛰어나서, 남들이 안 가본 길을 개척하는 걸 즐기지. 창업이나 교육 쪽이 잘 맞아.",
        3: "봄의 절정(묘월)에 태어난 너는 '인간관계'가 곧 자산이야. 사람을 다루는 기술이 뛰어나고, 꾸미는 감각도 있어서 디자인이나 예술, 서비스업에서 빛을 발할 거야.",
        4: "봄에서 여름으로 가는(진월) 너는 '변화무쌍한 능력자'야. 이상이 높고 포부가 커서 작은 물에서 놀기 힘들어. 스케일 큰 사업이나 중개, 유통 쪽에서 대박 날 수 있어.",
        5: "초여름(사월)의 너는 '활동성'이 무기야. 여기저기 돌아다니며 역동적으로 일해야 돈이 들어와. 말로 하는 직업이나 해외 관련 일, 혹은 화려한 조명을 받는 일이 천직이야.",
        6: "한여름(오월)의 너는 '열정 그 자체'야. 한번 꽂히면 불도저처럼 밀어붙이지. 솔직하고 화끈해서 리더십이 있지만, 욱하는 성질만 죽이면 사회적으로 크게 성공할 거야.",
        7: "늦여름(미월)의 너는 '끈기와 오기'가 있어. 겉으론 유순해 보여도 목표한 건 집요하게 물고 늘어지지. 기술직이나 전문직, 혹은 사람을 상대하는 상담 일이 잘 어울려.",
        8: "초가을(신월)의 너는 '재주꾼'이야. 다재다능해서 못 하는 게 없고, 상황 대처 능력이 뛰어나지. 금융, 엔지니어링, 혹은 군검경처럼 각 잡힌 조직에서도 잘 살아남아.",
        9: "가을의 절정(유월)에 태어난 너는 '완벽주의자'야. 맺고 끊는 게 확실하고, 일 처리가 깔끔해서 윗사람들의 신임을 얻지. 정밀한 기술, 의료, 보석 세공 같은 디테일한 일이 딱이야.",
        10: "늦가을(술월)의 너는 '신의와 원칙'을 중요시해. 한번 뱉은 말은 지키려고 노력하고, 책임감이 강해서 조직의 핵심 인재가 될 수 있어. 종교, 철학, 혹은 묵묵히 한 우물을 파는 일.",
        11: "초겨울(해월)의 너는 '지혜와 예지력'이 있어. 겉으론 멍해 보여도 남들보다 한 수 앞을 내다보고 있지. 무역, 해운, 혹은 정신적인 멘토링이나 교육 사업이 잘 맞아."
    }
    my_wolji = wolji_traits[month_idx]

    saju_db = {
        0: { # 갑목
            "element": "🌲 하늘을 뚫고 오르는 거목 (갑목)",
            "keywords": ["#자존심이_내_생명", "#고독한_선구자", "#책임감이라는_왕관"],
            "personality": f""""누가 감히 나를 가르치려 들어?"

너의 무의식 가장 깊은 곳에는 '내가 우두머리가 되어야 한다'는 강력한 본능이 용암처럼 흐르고 있어. 너는 태어날 때부터 하늘을 향해 곧게 뻗어 올라가야 하는 거대한 소나무(甲木)야. 남의 그늘 아래서 편하게 사느니, 차라리 비바람을 맞더라도 내 뿌리로 서겠다는 고집. 그게 너를 지금까지 지탱해 온 힘이자, 동시에 너를 가장 힘들게 만든 원인이야.

특히, {my_branch_trait}

그래서 너는 겉으로는 강한 척하지만, 속으로는 남들이 모르는 예민함과 외로움을 깊게 품고 있어. 아무에게도 들키고 싶지 않은 너만의 약점이지.

겉으로는 대범하고, 쿨하고, 리더십 있어 보이지? 남들은 네가 상처 안 받는 강철 멘탈인 줄 알아. 하지만 사실 너만큼 <span class='highlight'>'인정 욕구'</span>에 목마른 사람도 없어. "너 진짜 대단하다", "역시 너밖에 없어", "네가 아니면 안 돼"라는 말을 들으면, 겉으론 "뭘 이런 걸 가지고..." 하며 덤덤한 척해도, 속으로는 세상을 다 가진 듯한 짜릿한 희열을 느껴. 너는 그 칭찬 한마디를 연료 삼아 움직이는 폭주기관차 같은 사람이야.

반대로 누군가 너를 무시하거나, 네 의견을 깔아뭉개거나, 다른 사람과 비교한다? 그날은 분노가 치밀어서 잠도 못 자. 너의 자존심은 단순한 성격이 아니라, 네가 살아있음을 느끼는 생존 본능 그 자체거든. "감히 나를?" 이라는 생각이 머릿속을 지배하면, 너는 앞뒤 안 가리고 들이받아 버리지. 너는 타협할 줄 모르는 게 아니라, 타협하는 걸 '패배'라고 생각하는 거야.

[너의 그림자: The Shadow]
너는 '처음'을 좋아해. 남들이 안 가본 길, 새로운 시작, 개척하는 것. 하지만 그만큼 **'유지하고 관리하는 것'**에는 약해. 시작은 창대하나 끝이 미약한 경우가 종종 있지 않아? 벌려놓은 건 많은데 수습이 안 돼서 스트레스받는 밤, 익숙하지? 

그리고 무엇보다 너는 '힘들 때 기대는 법'을 몰라. 속은 썩어들어가는데 겉으로는 "난 괜찮아, 내가 알아서 할게"라며 센 척하다가, 집에 와서 혼자 있을 때 와르르 무너지는 게 너야. 남들에게 약한 모습 보이는 걸 죽기보다 싫어하니까. 너의 외로움은 스스로 만든 높은 성벽 때문일지도 몰라.""",
            "dawn_mind": """"현실과 이상의 괴리, 그 사이의 불면증."

새벽 2시, 네가 잠 못 드는 이유는 명확해. '네 머릿속 이상은 저기 하늘 꼭대기에 있는데, 현실의 내 발은 아직 땅에 처박혀 있다는 그 답답함' 때문이야.

너는 머릿속에 완벽한 성공의 설계도가 그려져 있어. '이 나이 땐 이 위치에 가야 하고, 저런 성과를 내야 하고, 남들이 우러러보는 사람이 되어야 하는데...' 그런데 현실이 그 속도를 못 따라오니까, 스스로에게 화가 나는 거야. 남들이 볼 땐 너 충분히 잘하고 있어. 하지만 너는 너 자신을 용서하지 못해. 너의 기준은 에베레스트 꼭대기에 있거든.

"난 더 높이 가야 하는데, 왜 지금 여기서 멈춰있지? 내가 겨우 이것밖에 안 되는 인간인가? 남들은 저만큼 앞서가는데 나는 도태되는 거 아닐까?"

그 조급함이 너를 갉아먹고 있어. 기억해. 소나무는 원래 잡초보다 자라는 속도가 느려. 하지만 한 번 자리를 잡으면 천 년을 버티는 숲의 주인이 돼. 지금 너의 불안은 성장이 멈춘 게 아니라, 더 높이 오르기 위해 뿌리를 깊게 내리고 있는 과정일 뿐이야. 스스로를 좀 놔줘. 너는 결국 해낼 사람이니까.""",
            "work_social": f""""타협을 모르는 독불장군, 혹은 위대한 리더."

사회생활 할 때 너를 한마디로 표현하면 '불도저'야. 목표가 정해지면 뒤도 안 돌아보고 밀어붙이는 추진력 하나는 정말 타고났어.

더 구체적으로 말하자면, {my_wolji}

이런 너의 사회적 성향 덕분에, 너는 남들보다 빠르게 기회를 잡거나, 혹은 남들과 다른 독특한 방식으로 성공을 거둘 잠재력이 충분해.

하지만 문제는 너의 '유연함 부족'이야. 너는 네 생각이 맞다고 확신하면, 옆에서 누가 무슨 조언을 해도 귀에 안 들어오지? 타협하고 굽히는 걸 '비굴하다'고 생각하잖아. 특히 무능한 상사를 만나면 너는 절대 그 사람을 존경하지 않고, 표정에서 경멸이 다 드러나게 돼 있어. "저 사람이 왜 내 상사지? 내가 더 잘하는데."라는 눈빛, 숨길 수 없잖아. 그런 태도가 너를 고립시킬 수 있어.

[돈과 욕망]
돈? 너는 푼돈 모으는 거에 관심 없어. 째째하게 100원, 200원 아끼느니 한 방에 크게 벌어서 폼 나게 쓰고 싶어 하지. 너에게 돈은 '생존 수단'이 아니라, '내 권력을 증명하는 계급장' 같은 거야. 그래서 남들한테 밥 사고 술 사는 돈은 안 아까워하는데, 정작 나를 위해 쓰는 소소한 돈은 아까워할 때가 있어. 친구들 사이에서 지갑 여는 건 늘 너지? "내가 낼게"라는 말 뒤에 숨겨진 "내가 너희보다 우월해, 내가 챙겨줘야 해"라는 무의식을 들여다봐야 해. 너는 돈보다 '가오'가 중요한 사람이야. 하지만 진짜 부자는 100원도 아낄 줄 아는 사람이라는 걸 잊지 마. 폼 잡다가 통장 잔고 비는 수가 있어.""",
            "relationship": f""""내 사람은 내가 지킨다. 대신, 배신은 죽음뿐."

너의 사랑은 '직진' 그 자체야. 이것저것 재고 따지는 계산적인 연애? 너는 그런 거 할 줄도 모르고 하기도 싫어해. 좋으면 좋은 거고 싫으면 싫은 거지, 헷갈리게 간 보거나 밀당하는 거 딱 질색이야. 너는 사랑을 할 때도 네가 리드해야 해. 상대방이 애매하게 굴면 "그래서 나랑 사귈 거야 말 거야?" 하고 돌직구 날려버리는 스타일이지.

내 사람이다 싶으면 넉넉한 그늘을 내어주고, 비바람을 막아주는 아낌없이 주는 나무가 되지. 너는 내 여자를, 내 남자를 지켜야 한다는 보호 본능과 책임감이 엄청 강해. 상대방이 기대오면 묵묵히 받아주는 든든한 버팀목이 되어주지. 네 울타리 안에 들어온 사람은 끝까지 책임지려고 해.

하지만 경고할게. 네 자존심을 건드리는 순간, 너는 세상에서 가장 냉정한 사람으로 변해. 상대방이 너를 무시하거나 통제하려 들면, 너는 싸우기보다 마음의 문을 쾅 닫아버려. 


이런 기질 때문에 연애할 때 상대방을 너도 모르게 쥐락펴락하거나, 반대로 상대방에게 푹 빠져서 헌신하다가 상처받는 패턴을 반복할 수 있어.

너는 뒤끝은 없는데, 한 번 돌아서면 다시는 안 돌아보는 무서운 결단력이 있어. 상대방은 네가 갑자기 변했다고 생각하겠지만, 사실 너는 속으로 수십 번 참고 기회를 주다가 "이제 끝이다"라고 선고를 내리고 뿌리째 뽑아버린 거야. 다시는 뒤를 돌아보지 않지. 

너의 사랑을 얻으려면? 너를 왕처럼, 여왕처럼 대접해 주는 사람이어야 해. 네가 존경할 수 있는 사람이거나, 아니면 너에게 전적으로 의지하는 순종적인 사람이거나. 어설프게 너를 가르치려 드는 사람은 절대 사절이야. 그리고 침대 위에서도... 너는 네가 주도하는 걸 은근히 즐기지? 정복감이 너의 사랑을 더 불타오르게 만드니까. 너는 밤에도 대장이어야 해.""",
            "advice": f"""친구야, 네 사주를 쭉 보니까 지금 네 마음이 어떤 상태인지 알 것 같아. 너는 아마 지금 "내가 과연 이대로 괜찮은 걸까?" 하는 깊은 회의감에 빠져있을지도 몰라.

최근에 네 자존심을 건드리는 일이 있었거나, 네가 계획했던 대로 일이 풀리지 않아서 속이 시끄럽지 않아? "내가 더 잘해야 하는데, 내가 더 강해져야 하는데" 하면서 스스로를 너무 몰아세우고 있는 것 같아서 안타까워.

네가 가진 그 '책임감'이라는 왕관의 무게, 그거 진짜 무거운 거 나도 알아. 남들은 네가 강해서, 잘나서 버티는 줄 알겠지만, 사실 너는 쓰러지는 게 무서워서 이 악물고 버티고 있는 거잖아. "내가 무너지면 다 끝이다"라는 그 생각 때문에, 아파도 아픈 척 못 하고, 힘들어도 내색 한 번 시원하게 못 하고.

근데 그거 알아? '나무가 부러지는 건 바람이 강해서가 아니라, 너무 뻣뻣해서야.'
태풍이 불 때 가장 먼저 부러지는 건 가장 단단한 고목나무래. 오히려 바람 부는 대로 몸을 맡기는 갈대는 절대 부러지지 않아.

지금 너에게 필요한 건 '더 강해지는 것'이 아니야. '조금은 유연해지는 것', '가끔은 져주는 것', '힘들면 힘들다고 말하는 것'이야. 그게 비굴한 게 아니라, 네가 더 높이 자라기 위한 가장 똑똑한 생존 전략이라는 걸 기억했으면 좋겠어.

너는 이미 충분히 멋진 나무야. 숲의 주인이 될 자격이 차고 넘쳐. 그러니까 오늘 밤은 제발, 네 뿌리가 좀 쉴 수 있게 스스로를 놔줘. 아무것도 증명하지 않아도 돼. 너는 존재 자체로 이미 숲이니까.

이런 네 타고난 기질도, 결국엔 네가 더 큰 그늘을 만들기 위한 밑거름이 될 거야. 걱정하지 마. 넌 무조건 잘 될 거니까.""",
            "closing": "그 무거운 왕관, 잠시 내려놓고 네 마음 좀 들여다볼까?"
        },
        1: { # 을목
            "element": "🌿 끈질기게 살아남는 야생화 (을목)",
            "keywords": ["#소름돋는_생존력", "#외유내강_끝판왕", "#부드러운_지배자"],
            "personality": f""""착해 보인다고? 너희는 내가 쓴 가면을 보고 있는 거야."

사람들은 널 보고 착하고 순하다고 말하지? 유순해 보이고 잘 웃으니까. 하지만 그건 네가 보여주는 사회적 생존 가면일 뿐이야. 너의 본질은 바위 틈, 아스팔트 바닥, 심지어 사막 한가운데 던져놔도 기어이 뿌리를 내리고 꽃을 피우는 **지독한 생존력** 그 자체야. 너는 남들이 다 포기하는 상황에서도 "어떻게든 되겠지" 하며 비집고 들어갈 틈을 찾아내는 천재야. 상황이 안 좋으면 죽는 게 아니라, 진화해 버리는 게 너라고.

특히, {my_branch_trait}

그래서 너는 겉으로는 약해 보여도, 속에는 누구보다 강한 독기와 오기를 품고 있어. 밟히면 밟힐수록 더 강하게 일어나는 잡초처럼 말이야.

너는 거목(甲木)처럼 정면으로 태풍과 싸우는 미련한 짓은 안 해. 바람이 불면 몸을 굽히고, 밟히면 잠시 납작 엎드려 있어. 하지만 절대 죽지 않지. 오히려 그 상황을 이용해서 덩굴처럼 타고 올라가 결국 가장 높은 곳을 차지해. 이게 바로 너의 무서운 점이야. 너는 강한 자에게 붙어서 그 힘을 이용할 줄 아는 영리함을 타고났어. "강한 자가 살아남는 게 아니라, 살아남는 자가 강한 것이다"라는 말은 너를 위해 존재하는 말이야.

겉으로는 "네네, 맞아요~" 하며 다 맞춰주는 척하지만, 머릿속으로는 이미 수만 가지 수를 계산하고 있잖아. 
'이 상황에서 어떻게 해야 내가 살아남을까? 누구 라인을 타야 이득일까? 저 사람은 나에게 득이 될까 실이 될까?' 

그 빠른 두뇌 회전과 눈치, 그리고 실속을 챙기는 능력이 너를 지키는 최고의 무기야. 남들이 "여우 같다"고 뭐라 하든 신경 쓰지 마. 결국 끝까지 살아남는 건 사자가 아니라 너니까. 너는 환경 적응력이 뛰어나서 어디에 던져놔도 굶어 죽지는 않을 거야.

[너의 그림자: The Shadow]
너는 가끔 너 자신이 무서울 때가 있지 않아? 웃으면서도 속으로는 상대를 냉정하게 평가하고 이용 가치를 따지는 너의 모습. 그리고 결정적인 순간에는 뒤도 안 돌아보고 손절해버리는 냉혹함. 너는 착한 게 아니라, 착한 게 생존에 유리하다는 걸 본능적으로 아는 것뿐이야. 그리고 남들이 모르는 지독한 열등감과 승부욕을 품고 있지. 겉으로는 양보하는 척하지만, 속으로는 '두고 보자, 내가 다 이길 거다'라고 칼을 갈고 있잖아. 너는 2등 콤플렉스가 있어서, 1등을 이기기 위해 수단과 방법을 가리지 않을 때가 있어.""",
            "dawn_mind": """"끝없는 눈치, 관계에서 오는 피로감."

네가 새벽에 힘든 이유는 단 하나, '사람' 때문이야.

너는 덩굴 식물이라 혼자 크기보단 주변 사람(나무)을 감고 올라가야 하는데, 그러다 보니 타인의 시선과 평가에 병적으로 예민해질 때가 있어. 낮에는 아무렇지 않게 웃으며 넘겼던 말들이, 새벽만 되면 비수가 되어 날아와 꽂히지.

"아까 걔 표정이 왜 그랬지? 내가 말실수했나? 날 싫어하나? 내가 너무 나댔나?"

이불 킥하면서 끊임없이 시뮬레이션을 돌리고, 카톡 하나 보내놓고 답장 올 때까지 전전긍긍하는 거... 이제 그만할 때도 됐잖아. 너는 관계 속에서 성장하지만, 때로는 그 관계가 너의 목을 조르기도 해. 명심해. 남들은 네 생각보다 너한테 관심 없어. 네가 느끼는 그 미묘한 공기, 사실은 너만 느끼는 과민반응일 수도 있어. 남들은 네가 무슨 말을 했는지 10분 뒤면 까먹는데, 너만 10년 동안 기억하고 있는 거야.

너는 혼자 있고 싶어 하면서도, 막상 혼자 있으면 외로워서 미쳐버리는 모순을 가지고 있어. 그래서 끊임없이 SNS를 확인하고, 누군가와 연결되어 있다는 걸 확인받고 싶어 하지. 그게 너의 외로움을 달래주는 유일한 마약이니까. 너는 사람을 싫어하지만, 사람 없이는 못 사는 존재야.""",
            "work_social": f""""적을 만들지 않고 실속을 챙기는 처세술의 달인."

너는 직장에서 적을 만들지 않아. 상사 기분도 잘 맞추고, 후배들도 잘 챙기는 척하면서 네가 원하는 건 다 얻어내지. 정치질? 마음만 먹으면 너를 따라올 사람이 없어. 너는 굳이 내가 총대를 메고 나서서 피 흘리는 리더가 되기보단, 리더 옆에서 조종하는 '실세'가 되는 걸 선호해. 2인자 전략, 그게 너한테 딱이야. 남들이 싸우는 동안 너는 전리품을 챙기는 스타일이지.

게다가 {my_wolji}
이런 환경적 요인 덕분에 너는 사회생활에서 어떻게 처신해야 살아남고, 어떻게 해야 돈을 벌 수 있는지 본능적으로 알고 있어.

[돈과 욕망]
그리고 너는 <span class='highlight'>'돈 냄새'</span>를 기가 막히게 맡아. 명예나 자존심보다는 '실리'가 중요해. 겉멋 든 사업보다는 당장 내 통장에 꽂히는 현금이 중요한 현실주의자지. 그래서 생활력 강하다는 소리를 듣는 거고. 너는 망해도 절대 혼자 안 망해. 솟아날 구멍을 세 개쯤은 파놓고 움직이는 치밀함이 있거든.

너는 정보를 수집하고 가공하는 능력이 뛰어나. 남들이 흘려듣는 소문이나 정보도 너에게는 돈이 되고 기회가 되지. 너의 그 가벼운 발놀림이 너를 부자로 만들어 줄 거야. 너는 돈을 좇지 않아도, 돈이 붙게 만드는 재주가 있어. 가끔은 너무 계산적이라는 소리를 듣기도 하지만, 뭐 어때? 자본주의 사회에서 그건 칭찬이야. 너는 실속 없는 명예 따위 개나 줘버리라고 생각하잖아.""",
            "relationship": f""""부드러운 구속, 벗어날 수 없는 덩굴."

너는 '질투의 화신'이야. 겉으론 쿨한 척, 이해심 넓은 척하지만 내 연인이 다른 이성을 쳐다보는 꼴은 죽어도 못 봐. 너의 소유욕은 상상을 초월해. 내 사람이다 싶으면 덩굴처럼 칭칭 감아서 절대 못 도망가게 옭아매는 기질이 있어. 너의 사랑은 헌신적이지만, 동시에 상대를 질식하게 만들 수도 있어. 너는 사랑하는 사람을 너의 통제 하에 두고 싶어 해. "어디야? 뭐해?"라는 연락은 관심이 아니라 감시일 때가 많지.

그래서 너는 연애할 때 상대방을 은근히 구속하거나, 반대로 상대방에게 꽉 잡혀 사는 듯하면서도 실속은 다 챙기는 고단수 연애를 할 가능성이 높아.

그리고 너는 은근히 '나를 성장시켜 줄 수 있는 사람'을 본능적으로 찾아. 단순히 좋아서 만나는 것보다, 연애에서도 배울 점이 있거나 내 인생에 실질적인 도움이 되는 사람을 선호하지. 기대고 의지할 수 있는 튼튼한 나무 같은 사람을 원해. "능력 없는 사람은 매력 없어"라고 생각하지 않아?

가장 놀라운 건, 상대방에게 다 맞춰주는 것 같지만, 정신 차려보면 상대방이 네가 원하는 대로 움직이고 있다는 거야. "어? 내가 왜 이러고 있지?" 하게 만드는 부드러운 가스라이팅(?), 아니 조련 능력이 탁월해. 너는 남자를, 여자를 다룰 줄 아는 타고난 연애 고수야. 칭찬으로 고래를 춤추게 하는 게 아니라, 칭찬으로 상대를 내 노예로 만드는 재주가 있지. 너한테 걸리면 빠져나가기 힘들어. 너는 밤에도 수동적인 척하지만 사실은 모든 흐름을 네가 쥐고 있을걸? 네가 원하는 대로 상대가 움직여주길 바라면서 은근히 유도하는 고단수지.""",
            "advice": f"""야, 너 지금 인간관계 때문에 머리 터질 것 같지? 
누구는 챙겨야 하고, 누구 눈치는 봐야 하고, 저 사람은 나를 어떻게 생각할까 고민하느라 정작 '너 자신'은 하나도 못 챙기고 있잖아.

내가 너한테 꼭 해주고 싶은 말은 이거야. "눈치 좀 그만 보고, 이제 좀 뻔뻔해져라."
너는 잡초야. 밟히면 밟힐수록 더 질기게 살아나는 생명력이 있다고. 남한테 맞추느라 네 색깔을 잃어버리지 마. 가면을 너무 오래 쓰고 있으면, 나중에 가면이 안 벗겨진다? 

너는 이미 충분히 영리하고, 생활력 강하고, 어디 가서도 굶어 죽지 않을 능력자야. 그러니까 쫄지 마. 누가 너를 싫어하면 "어쩌라고? 나도 너 싫어" 하고 쿨하게 넘기는 연습 좀 해. 착한 아이 콤플렉스는 이제 갖다 버려.

네 안에 숨겨진 이 기질을 억누르지 말고, 오히려 무기로 써먹어 봐. 네 유연함은 비굴함이 아니라, 세상을 네 뜻대로 주무를 수 있는 최고의 곡예니까. 넌 결국 다 이겨먹을 거야.""",
            "closing": "눈치 보느라 구겨진 네 마음, 이제 좀 펴볼까?"
        },
        2: { # 병화
            "element": "☀️ 가장 높은 곳의 태양 (병화)",
            "keywords": ["#감정_투명도_100%", "#화려한_공허함", "#관심_중독"],
            "personality": f""""내 기분이 곧 세상의 날씨다."

너는 태생적으로 숨기는 걸 못 해. 기분이 좋으면 얼굴에서 빛이 나고, 기분이 나쁘면 이마에 '건드리지 마'라고 써지잖아. 너는 하늘에 뜬 태양(丙火)이라, 네가 우울하면 주변 공기까지 차가워지고, 네가 웃으면 온 세상이 환해져. 그만큼 너라는 사람의 에너지가 주변을 압도한다는 뜻이야. 너는 존재만으로도 '주인공'이 되는 사람이야. 어디를 가든 네가 중심이어야 하고, 사람들의 시선을 받아야 에너지가 충전되지. "내가 왔어!"라고 등장해야 직성이 풀리는 스타일.

특히 {my_branch_trait}

그래서 너는 더더욱 감정을 숨길 수 없고, 네가 있는 곳은 언제나 시끌벅적할 수밖에 없어.

성격은 또 얼마나 급한지. 욱! 하고 불같이 화냈다가 5분 뒤에 "아, 배고프다. 뭐 먹을래?" 하는 스타일이지? 뒤끝이 없어서 좋긴 한데, 주변 사람들은 네 기분 맞추느라 매일 롤러코스터 타는 기분일 거야. 너는 악의는 없는데, 네 뜨거움에 남들이 델 수 있다는 걸 가끔 잊어버려. 너의 분노는 여름 소나기 같아서, 확 쏟아지고 나면 언제 그랬냐는 듯 쨍하고 개지. 그래서 넌 편할지 몰라도, 젖은 사람은 찝찝해한다는 걸 알아야 해.

너는 예의 바른 척 가식 떠는 걸 제일 싫어해. 솔직하고, 화끈하고, 투명한 게 최고라고 생각하지. 하지만 그 솔직함이 때로는 무례함이 될 수도 있다는 걸 알아야 해. 너의 말은 빛처럼 빠르지만, 때로는 화살처럼 꽂히기도 하거든.

[너의 그림자: The Shadow]
너는 비밀을 못 지켜. 입이 가벼워서가 아니라, 그냥 다 말하고 싶어서 입이 근질거리는 거야. 너한테 비밀 얘기 하면 3일 뒤에 온 동네 사람들이 다 알게 될 수도 있어. 그리고 넌 그걸 '공유'라고 생각하지. 너는 뒤에서 호박씨 까는 것보다 앞에서 대놓고 싸우는 걸 선호하지? 음침한 걸 딱 질색하니까. 하지만 너의 그 밝음이 누군가에겐 폭력이 될 수도 있다는 걸 기억해.""",
            "dawn_mind": """"군중 속의 고독, 화려함 뒤의 짙은 그림자."

남들이 보는 너: 세상 걱정 없고, 자신감 넘치고, 늘 밝은 사람.
새벽 2시의 너: "아, 인생 다 부질없다... 나 진짜 혼자네."

이 갭(Gap)이 너를 미치게 만들어. 태양은 가장 밝지만, 동시에 가장 외로운 별이야. 낮에는 사람들 틈에서 웃고 떠들며 에너지를 쏟아붓지만, 밤에 집에 돌아와 현관문을 여는 순간 밀려오는 공허함에 압사당할 것 같은 기분을 느끼지. TV나 유튜브를 틀어놓지 않으면 그 적막을 견딜 수가 없어. 혼자 있는 시간, 침묵이 흐르는 시간을 너는 견디기 힘들어해.

"내가 사람들에게 잘해주는 만큼, 쟤네는 나를 생각해주나?"
이런 계산이 드는 순간 걷잡을 수 없는 서운함이 밀려오지? 너는 사랑과 관심을 먹고 사는 존재라, 네가 비추는 만큼 반사되어 돌아오지 않으면 빛을 잃어버려. 너의 우울은 '관심의 결핍'에서 오는 경우가 많아. 너는 혼자 빛날 수 있지만, 그 빛을 봐주는 사람이 없으면 의미가 없다고 생각해. 그래서 관종이라는 소리를 듣기도 하지만, 넌 관심이 없으면 죽어.""",
            "work_social": f""""무대 체질, 하지만 디테일은 꽝."

너는 스포트라이트를 받아야 일을 잘해. 구석에 박혀서 엑셀이나 두드리고 있는 건 너한테 고문이야. 사람들 만나고, 프레젠테이션하고, 판을 크게 벌리는 일을 해야 직성이 풀려. "내가 쏠게!" 하며 호기롭게 분위기 띄우는 것도 좋아해서 영업이나 마케팅, 방송 쪽에 소질이 있어. 너는 사람들을 홀리는 매력이 있거든.

게다가 {my_wolji}

이런 기질 덕분에 너는 사람들 앞에 나서는 직업이나, 너의 매력을 발산할 수 있는 곳에서 큰 성공을 거둘 수 있어.

하지만 치명적인 단점은 <span class='highlight'>'마무리'</span>가 약하다는 거야. 시작은 창대하게 저질러 놓는데, 뒷수습을 못 해서 흐지부지되는 경우가 많아. 꼼꼼하게 챙기는 건 귀찮거든. "좋은 게 좋은 거지~" 하고 넘어가려다가 사고 치는 경우 있지? 그래서 네 옆에는 너의 그 덤벙거림을 챙겨줄 꼼꼼한 참모가 반드시 필요해. 혼자 다 하려고 하지 마.

너는 칭찬을 먹고 자라. "잘한다, 멋있다" 해주면 밤새서라도 일하는데, 싫은 소리 한마디 들으면 바로 의욕 상실해서 드러눕는 단순함이 있어. 너를 다루는 법은 아주 쉬워. 칭찬해주고 띄워주면 넌 간이고 쓸개고 다 빼주니까. 직장 상사가 너를 칭찬하면 넌 노예처럼 일할지도 몰라.""",
            "relationship": f""""나를 숭배하라, 그러면 모든 걸 주리라."

전형적인 '금사빠(금방 사랑에 빠짐)'. 
한 번 꽂히면 앞뒤 안 가리고 직진해서 내 모든 걸 다 퍼주는데, 식는 것도 LTE급이야. 너의 사랑은 활화산처럼 폭발적이지만, 연료가 떨어지면 순식간에 재만 남을 수 있어. 너는 사랑을 할 때 계산하지 않아. 그래서 많이 다치기도 하지.

너는 너를 숭배해주고, 박수 쳐주고, "네가 최고야, 너 진짜 멋있다"라고 해주는 팬(Fan) 같은 사람을 만나야 행복해. 네 빛을 가리거나, 너를 가르치려 들거나, "너 옷이 그게 뭐냐"라고 지적하는 사람은 절대 못 만나. 


이런 성향 때문에 너는 연애할 때도 네가 주인공이어야 해. 상대방은 너를 빛내주는 조연 역할을 자처해야 트러블이 없어.

네 자존심을 세워주는 사람에게는 간 쓸개 다 빼주지만, 무시하는 사람에게는 쳐다도 안 보는 극단적인 면이 있어. 너의 그 뜨거움을 감당해 줄 수 있는 넓은 바다 같은 사람이 필요해. 질투도 불같이 하지만, 네가 딴눈파는 건 또 관대하지? "난 잠깐 본 거고, 넌 마음 준 거잖아!"라는 논리, 너만 이해하는 거야.""",
            "advice": f"""친구야, 너 지금 많이 지쳐 보이나? 
겉으로는 아무렇지 않은 척, 세상 밝은 척하고 있지만, 속은 시커멓게 타들어가고 있는 거 다 보여.

지금 너는 어쩌면 '인간관계 회의감' 때문에 멘탈이 나가 있을지도 몰라. "내가 이렇게까지 했는데, 쟤는 나한테 왜 저래?" 하는 그 억울함 말이야. 네가 베푼 만큼 돌아오지 않으니까, 밑 빠진 독에 물 붓는 기분이겠지.

내 친구로서 너한테 딱 한마디만 할게. "제발 남 걱정 좀 그만하고, 불 끄고 좀 쉬어."
태양도 밤에는 퇴근해야 달이 뜨잖아. 너는 24시간 내내 빛나려고 해서 탈이야. 모든 사람에게 좋은 사람일 필요 없고, 모든 모임의 주인공일 필요 없어. 가끔은 존재감 없이 구석에 처박혀 있어도 돼.

이런 네 기질 때문에 너는 더더욱 감정을 주체 못 하고 힘들어할 때가 많아. 하지만 기억해. 네가 빛나지 않아도, 어둠 속에 있어도 널 사랑해 줄 사람은 곁에 남을 거야. 너의 존재 가치는 '쓸모'나 '밝음'에 있는 게 아니라, 그냥 '너'라는 존재 그 자체에 있어. 오늘은 핸드폰도 끄고, 아무것도 하지 말고 그냥 멍하니 있어봐. 그래도 세상 안 망해.""",
            "closing": "화려한 조명이 꺼진 뒤, 진짜 너는 어떤 모습일까?"
        },
        3: { # 정화
            "element": "🕯️ 고요하게 타오르는 촛불 (정화)",
            "keywords": ["#섬세한_광기", "#지독한_기억력", "#희생과_집착"],
            "personality": f""""평소엔 성녀(聖女), 건드리면 마녀(魔女)."

너는 평소엔 한없이 온화하고 따뜻해. 남의 아픔을 내 것처럼 공감해 주고, 세심하게 챙겨주는 배려심은 타고났지. 사람들이 "너랑 얘기하면 힐링 돼"라는 말을 자주 하지? 하지만 그건 네가 촛불(丁火)이기 때문이야. 촛불은 자신을 태워서 남을 밝혀주니까. 너의 친절은 너의 희생을 담보로 하고 있어.

하지만 잊지 마. '촛불도 불이야.' 작고 약해 보인다고 함부로 건드렸다간 산 전체를 태워버리는 화마가 될 수 있어. 너의 분노는 태양(병화)처럼 겉으로 펑펑 터지는 게 아니라, 안으로 응축되었다가 레이저처럼 상대를 꿰뚫어 버려. 조용히, 하지만 가장 치명적인 곳을 찌르는 게 너의 복수 방식이야.

특히 {my_branch_trait}

그래서 너는 겉으로는 웃고 있어도 속으로는 칼을 갈고 있는 경우가 많아.

평소에 싫은 소리 못 하고 꾹꾹 참다가, 임계점을 넘는 순간 눈이 돌아가서 상대를 잿더미로 만들어버리지. 남들은 "얘가 갑자기 왜 이러지?" 하고 놀라겠지만, 너는 갑자기가 아니야. 수백 번 참다 터진 거지. 디테일에 강하고 예민해서, 남들이 무심코 던진 말 한마디, 표정 하나에도 의미를 부여하고 상처받는 여린 마음이 너를 힘들게 해. 너는 겉으로는 웃고 있어도 속으로는 피눈물을 흘리고 있을 때가 많아.

[너의 그림자: The Shadow]
너는 착해 보이지만, 사실은 누구보다 '조종'하고 싶어 해. 네가 희생함으로써 상대방에게 죄책감을 심어주고, 결국 네 뜻대로 움직이게 만드는 무서운 힘이 있어. "내가 널 위해 이렇게까지 했는데..." 이 말이 너의 필살기지.""",
            "dawn_mind": """"판도라의 상자가 열리는 시간."

너에게 새벽 2시는 감수성 스위치가 켜지면서 뇌 속에 저장된 과거의 기억들이 4K HD 고화질로 재생되는 시간이야.

3년 전 걔가 했던 말, 5년 전 억울했던 상황, 전 애인의 SNS, 내가 그때 왜 그랬을까 하는 자책... 
잊고 싶은데 잊혀지지가 않지? 너는 기억력이 좋은 게 아니라, <span class='highlight'>'감정의 기억'</span>이 지독하게 좋은 거야. 그때의 그 기분 나쁨, 서러움이 생생하게 되살아나서 널 괴롭혀.

너는 기본적으로 'Give & Take'의 마인드가 있어. "내가 이만큼 널 위해 희생했는데, 넌 나한테 이래?"라는 보상심리가 충족되지 않으면 억울해서 미쳐버릴 것 같은 기분. 그 원망과 억울함이 너의 새벽을 갉아먹고 있어. "두고 보자"라며 이를 갈다가도, 또 금방 마음 약해져서 눈물 흘리는 너잖아. 복수하고 싶은데 마음이 약해서 복수도 못 하는 스스로가 답답하지?""",
            "work_social": f""""완벽하지 않으면 시작도 하기 싫어."

너는 디테일의 여왕/왕이야. 남들이 "대충 이 정도면 됐지" 하고 넘길 때, 너는 폰트 크기 하나, 줄 간격 하나, 뉘앙스 하나까지 신경 써야 직성이 풀려. 전문적인 기술, 예술, 상담, 교육 쪽으로 가면 대성할 수 있어. 너의 그 섬세함은 재능이거든.

게다가 {my_wolji}

이런 성향 때문에 너는 전문적인 기술이나 예술, 상담 쪽으로 가면 대성할 수 있어.

하지만 사회생활에선 좀 피곤할 수 있어. 동료들의 무신경함이 너에겐 상처가 되고, 네가 챙겨준 만큼 돌아오지 않으면 혼자 삐지기도 잘해. "어떻게 저렇게 눈치가 없지?"라며 속으로 욕하고 있잖아. 너무 완벽하려고 하지 마. 너는 이미 충분히 잘하고 있어.

너는 '인정'을 받아야 일할 맛이 나. 돈보다도 "네 덕분에 해결됐어"라는 말이 너를 움직이는 원동력이야. 그래서 너는 몸이 부서져라 일하고, 결국 골병이 들지. 너는 남의 일을 내 일처럼 하다가 번아웃이 오는 스타일이야. 거절 못 하는 병, 그거 고쳐야 해.""",
            "relationship": f"""**"너의 모든 것을 알고 싶어."**

너는 분위기에 약한 로맨티시스트야. 촛불 켜놓은 듯한 은은한 분위기, 따뜻한 말 한마디에 훅 넘어가지.
하지만 사랑이 깊어질수록 '집착과 의심'도 같이 자라나. 너의 사랑은 따뜻하지만, 때로는 너무 뜨거워서 상대를 숨 막히게 할 수도 있어.

상대방의 일거수일투족을 알아야 마음이 놓이고, 작은 거짓말도 용납 못 하는 수사관 기질이 있지? 촉이 무서울 정도로 좋아서 상대방이 딴생각하는 거 귀신같이 알아채잖아. 


이런 기질 때문에 너는 상대방을 너의 통제 하에 두고 싶어 하거나, 상대방에게 모든 걸 맞추다가 혼자 상처받곤 해.

의심이 시작되면 꼬리에 꼬리를 물고 시나리오를 쓰고, 상대를 들달 볶게 돼. 너를 위해서라도 그 불을 좀 꺼야 해. 집착은 사랑이 아니라 너의 불안이야. 너는 사랑을 하면 그 사람에게 헌신하지만, 그만큼 바라는 것도 많아져서 힘들어지는 거야. "내가 널 어떻게 키웠는데(?)" 식의 마인드를 버려야 해. 

그리고... 너 밤에는 낮보다 훨씬 과감해지지? 너의 내면엔 겉모습과는 다른 뜨거운 열정이 숨어있으니까.""",
            "advice": f"""지금 너는 '감정의 과부하' 상태일 가능성이 높아. 너무 많은 사람들의 감정을 받아주다가 네 그릇이 꽉 차버린 거지.

종합적으로 해주고 싶은 말은, "너의 그 귀한 따뜻함을 아무한테나 낭비하지 마." 촛불은 바람 불면 꺼져. 너를 바람막이처럼 소중하게 지켜줄 사람에게만 너를 태워.

제발 너 자신을 먼저 태워서 남을 밝히려고 하지 마. 네 심지가 다 타버리면 세상도 어두워져. 지금은 좀 이기적으로 살아도 돼. 남들 챙기기 전에 너부터 챙겨. 너는 충분히 사랑받을 자격이 있어.

이런 네 성격 때문에 더 힘든 거 알아. 겉으로는 웃고 있어도 속으로는 칼을 갈고 있거나, 혼자 울고 있잖아. 하지만 네가 꺼지면 네 세상도 어두워진다는 걸 잊지 마. 너는 충분히 사랑받을 자격이 있어.""",
            "closing": "남을 비추느라 지쳐버린 너의 마음, 이제 내가 채워줄게."
        },
        4: { # 무토
            "element": "⛰️ 침묵하는 거대한 태산 (무토)",
            "keywords": ["#절대적_신뢰", "#고집불통", "#감정의_변비"],
            "personality": f""""속을 알 수 없는 사람? 아니, 그냥 말을 안 하는 사람."

사람들이 너한테 비밀 얘기 많이 하지? 네가 입 무겁고 듬직해 보이니까. 너는 거대한 산(戊土)이야. 누가 와서 기대든, 땅을 파든, 나무를 심든 묵묵히 다 받아주는 엄청난 포용력이 있어. 너는 웬만해선 화도 잘 안 내. 그냥 "허허, 그래 그래" 하고 넘기는 대인배 같은 면모가 있지.

하지만 정작 <span class='highlight'>너는 네 속마음을 절대, 죽어도 안 보여줘.</span> 친한 친구들도 가끔은 "도대체 쟤는 무슨 생각 하는지 모르겠다"라고 하지 않아? 너는 네 감정을 드러내는 걸 약점 잡히는 거라고 생각하거나, "굳이 말해서 뭐 하나, 입만 아프지"라는 특유의 허무주의가 깔려 있어. 네 마음은 첩첩산중이라 너 자신도 길을 잃을 때가 있지?

특히 {my_branch_trait} 그래서 너는 입을 다물고 있지만, 속으로는 이미 결론을 다 내리고 요지부동인 거야.

그리고 너, '고집 세기로는 전교 1등'일걸? 평소엔 곰처럼 순해 보이지만, 네가 마음속으로 한 번 "이건 아니다"라고 정하면, 옆에서 꽹과리를 치고 굿을 해도 절대 안 움직여. 그 우직함이 신뢰를 주기도 하지만, 때로는 미련할 정도로 변화를 거부해서 좋은 기회를 놓치기도 해. 너를 움직이게 하려면 논리가 아니라 감동이 필요해.""",
            "dawn_mind": """"감정의 변비, 속에서 곪아 터지는 침묵."

네가 새벽에 힘든 이유는 단 하나야. '감정의 변비' 상태거든.

힘들면 힘들다, 싫으면 싫다, 좋으면 좋다. 말을 하고 털어내야 하는데, 너는 모든 걸 속으로 삼켜버려. 
"내가 좀만 참으면 조용히 넘어가겠지", "굳이 분란 일으키고 싶지 않아".

그렇게 쌓인 감정들이 네 안에서 썩어가고 있어. 아무도 없는 깊은 산속에서 혼자 소리치는 기분, 그 지독한 외로움은 사실 너 스스로 만든 감옥일 수도 있어. 네가 문을 닫아걸었잖아. 남들이 들어오고 싶어도 네가 너무 높고 험준해서 못 올라가는 거야. 가끔은 산사태가 난 것처럼 감정을 쏟아내도 돼. 그래야 숨통이 트이지.

너는 혼자 있는 걸 좋아하면서도, 누군가 먼저 다가와 주길 간절히 바라고 있어. "누가 내 마음 좀 알아줬으면..." 하면서도 입은 꾹 다물고 있지. 텔레파시는 없어. 말 안 하면 아무도 몰라. 네 침묵은 금이 아니라 독이야.""",
            "work_social": f""""신뢰의 아이콘, 하지만 융통성은 제로."

너는 조직에서 '믿을맨'이야. 맡은 일은 묵묵하게 끝까지 해내니까. 변덕 부리지 않고 한 우물을 파는 끈기는 타의 추종을 불허해. 남들이 다 도망가도 너는 그 자리를 지키고 있을 사람이야. 그래서 윗사람들이 너를 좋아해.

더 구체적으로 {my_wolji}
그래서 너는 한 직장에서 오래 버티거나, 전문직으로 성공할 확률이 높아.

하지만 **'순발력'**은 좀 떨어져. 갑작스러운 변화나 새로운 시도를 싫어하고, 하던 대로 하는 걸 좋아하지. 그래서 트렌드에 뒤처질 수도 있어. 너는 빠릿빠릿하게 움직이는 것보다, 묵직하게 중심 잡는 게 어울려.

중간 관리자 역할을 하면 딱 좋아. 위와 아래를 연결해 주는 다리 역할. 네 무게감이 중심을 잡아주니까. 하지만 너무 원칙만 따지다가 꼰대 소리 들을 수 있으니 조심해. 융통성, 그게 너한테 제일 필요한 스킬이야. 너는 한 번 시작하면 끝을 보지만, 시작하기까지 시간이 너무 오래 걸려. 고민만 하다가 날 새지 마.""",
            "relationship": f""""표현하지 않는 사랑은 짝사랑과 같다."

너는 상대를 정말 사랑하는데, 표현을 안 하니까 상대방은 "나만 좋아하는 건가? 얜 왜 반응이 없지?" 하고 불안해해. 
"말 안 해도 알겠지"라는 생각은 너만의 엄청난 착각이야. 말 안 하면 귀신도 몰라. 너의 무뚝뚝함이 상대방을 외롭게 만들 수 있어.

그래도 너의 진가를 아는 사람은 너를 못 떠나. 한 번 사귀면 바람 안 피우고, 어떤 일이 있어도 끝까지 책임지는 진국 중의 진국이니까. 너에게 신뢰는 목숨과도 같으니까. 가벼운 연애보다는 결혼을 전제로 한 무거운 연애가 잘 어울려. 

그래서 너는 연애할 때도 상대방에게 무언가를 강요하기보다는 묵묵히 기다려주는 스타일이야.

너는 곰 같은 남자/여자라서 여우 같은 사람을 만나야 조련당하면서 행복하게 산다. 리드해 주는 사람이 필요해. 그리고 너는 평소엔 점잖지만, 한번 마음 열면 밤에는... 짐승(?)으로 돌변하는 반전 매력도 있지. 에너지가 넘치거든.""",
            "advice": f"""지금 너는 '정체기'를 겪고 있을 수 있어. 뭔가 답답하고 꽉 막힌 느낌. 움직여야 하는데 몸이 무거운 느낌.

종합적으로 해주고 싶은 말은, "산에도 메아리가 필요해." 감정을 쌓아두지만 말고 흘려보내야 새 물이 들어와. 오늘 일기장에라도 시원하게 욕 한 바가지 쓰고 자. 벽보고 소리라도 질러.

그래서 더 답답한 거야. 네가 입을 닫고 있으면 아무도 네 마음을 몰라. 

그래야 네 마음에 다시 사람을 품을 공간이 생겨. 곰처럼 참지 말고 여우처럼 표현해 봐. 그게 너를 살리는 길이야.""",
            "closing": "묵직한 바위 속에 숨겨둔 여린 마음, 내가 안아줄게."
        },
        5: { # 기토
            "element": "🚜 무엇이든 길러내는 비옥한 텃밭 (기토)",
            "keywords": ["#철저한_실속파", "#완벽주의적_의심", "#자기관리_끝판왕"],
            "personality": f""""친절한 얼굴 뒤에 숨겨진 계산기."

너는 절대 손해 보는 장사는 안 하지. 현실 감각이 뛰어나서 어떻게 해야 내가 이득을 볼지 본능적으로 알고 있어. 남을 잘 챙겨주고 다정해 보이고, 상담도 잘해주지? 하지만 너의 머릿속으로는 끊임없이 계산기를 두드리고 있어. 
'이 사람이 내 인생에 도움이 될까? 저 사람과 엮이면 피곤해질까? 내가 이만큼 해주면 쟤는 뭘 줄까?'

너는 뭐든 심으면 잘 자라는 비옥한 텃밭(己土)이라서, 이것저것 할 줄 아는 것도 많고(잡학다식), 자기관리도 철저해. "너는 참 야무지다", "똑 부러진다"라는 말을 자주 듣지? 

하지만 그만큼 <span class='highlight'>의심이 많아.</span> 돌다리도 두들겨 보고, 안 안전하면 절대 안 건너는 스타일이야. 사람을 쉽게 믿지 않아. 겉으로는 웃고 있지만 속으로는 끊임없이 상황을 분석하고, 사람을 평가하고, 내 위치를 점검하느라 뇌가 쉴 틈이 없어. 그래서 늘 피곤한 거야. 

특히 {my_branch_trait} 그래서 너는 더더욱 실속을 따지고, 네 울타리 안에 있는 것들만 챙기려는 성향이 강해.

너의 친절함 뒤에는 늘 날카로운 계산과 방어기제가 숨어 있다는 걸, 너 자신은 알잖아. 너는 '내 사람'과 '남'을 구분하는 선이 아주 뚜렷해. 내 사람에겐 한없이 퍼주지만, 선 밖의 사람에겐 1원 한 푼도 아까워하지.""",
            "dawn_mind": """"통제할 수 없는 변수가 주는 공포."

네 불안의 원인은 '통제할 수 없는 변수'야.

너의 하루는 네 머릿속 계획표대로, 예상 범위 안에서 흘러가야 마음이 편해. 그런데 갑자기 내일 일정이 꼬이거나, 예상치 못한 지출이 생기면 스트레스받아서 잠을 못 자. 작은 실수 하나에도 "아, 미치겠네" 하며 예민하게 반응하지.

완벽하게 준비되지 않으면 시작조차 안 하려는 그 강박. "실수하면 어떡하지? 망하면 어떡하지?" 그 걱정이 너를 갉아먹고 있어. 너는 실패가 두려운 게 아니라, 네가 상황을 통제하지 못하는 무력감을 두려워하는 거야. 좀 틀려도 세상 안 무너져. 네 계획표보다 세상은 훨씬 불규칙해. 그걸 받아들여야 네가 편해져. 너는 완벽하지 않아도 충분히 사랑스러워.""",
            "work_social": f""""비서실장, 참모, 교육자의 별."

너는 누군가를 가르치거나, 서포트하거나, 관리하는 일에 탁월해. 꼼꼼하고 기억력이 좋아서 남들이 놓치는 디테일을 다 잡아내거든. 1등이 되려고 아등바등하기보단, 실속 있는 2등이나 알짜배기 부자가 되는 길을 택하지. 너는 남들 앞에서 폼 잡는 것보다 내 통장 잔고가 늘어나는 게 더 행복한 사람이야.

게다가 {my_wolji}
이런 성향 때문에 너는 실속을 챙기는 데 도가 텄어.

하지만 '결정장애'가 좀 있어. 이것저것 재다가 타이밍 놓치는 경우 많지? 너무 안전한 길만 가려다 보니 대박 칠 기회를 놓치기도 해. 가끔은 위험을 감수하는 배짱도 필요해. 너는 멀티태스킹이 가능한 능력자지만, 하나에 깊게 몰입하는 건 좀 어려워해. 얕고 넓게 아는 지식이 너의 무기야.""",
            "relationship": f""""잔소리는 나의 사랑의 언어."

불타는 사랑? 너는 그런 거 별로 안 좋아해. 감정 소모 심한 연애는 질색이야. 친구같이 편안하고 안정적인 연애, 서로의 삶에 도움이 되는 생산적인 관계를 선호해. 데이트할 때도 가성비 따지거나 쿠폰 쓰는 걸 부끄러워하지 않지.

그리고 은근히 상대방을 '내 입맛대로 키우려고(교육하려고)' 하는 기질이 있어. 
"양말은 이렇게 뒤집어 놓지 마", "돈은 이렇게 써야지".
상대방의 옷차림, 말투, 생활 습관 하나하나 지적하고 고쳐주려 하지. 그게 사랑이라고 생각하겠지만, 상대방은 숨 막힐 수도 있다는 거 명심해. 

이런 기질 때문에 너는 연애할 때도 꼼꼼하게 따지고 분석하는 경향이 있어.

너는 엄마가 아니라 애인을 원하는 거잖아. 너는 내조/외조의 왕이지만, 그만큼 대우받기를 원해. 그리고 너는 육체적인 사랑보다 정신적인 안정감을 더 중요하게 생각하지만, 막상 스킨십하면 꽤나 적극적이지? 너는 편안한 침대와 분위기가 갖춰져야 사랑을 나눌 마음이 생기는 타입이야.""",
            "advice": f"""지금 너는 '복잡한 생각' 때문에 머리가 터질 것 같을 거야. 이거 할까 저거 할까, 이게 맞나 저게 맞나.

종합적으로 해주고 싶은 말은, "너무 계산하지 마." 머리 굴리다가 좋은 타이밍 다 놓친다. 가끔은 손해 보는 셈 치고 저질러 봐. 흙탕물 좀 튀어도 안 죽어. 오히려 그게 거름이 돼서 더 큰 열매를 맺게 해줄 거야.

이런 기질 때문에 더 신중한 건 알겠는데, 가끔은 그냥 저질러도 돼.

너의 그 의심을 조금만 거두면, 세상은 훨씬 살만한 곳일 거야. 넌 충분히 똑똑하니까, 네 직감을 믿어봐.""",
            "closing": "복잡한 계산기는 잠시 꺼두고, 있는 그대로의 너를 마주해 봐."
        },
        6: { # 경금
            "element": "🪨 다듬어지지 않은 거친 원석 (경금)",
            "keywords": ["#의리에_살고_죽음", "#인간_팩트폭격기", "#강강약약"],
            "personality": f""""가식 떨지 마. 토 나오니까."

너는 애매한 거 딱 질색이지? 좋으면 좋고, 싫으면 싫은 거야. 너의 사전에는 '적당히', '좋은 게 좋은 거'라는 단어가 없어. 호불호가 너무 확실해서, 내 사람이다 싶으면 간 쓸개 다 빼주며 의리를 지키는데, 한번 눈 밖에 나면 뒤도 안 돌아보고 손절해 버려. 냉정하다고? 아니, 너는 그게 깔끔하고 솔직한 거라고 생각해.

너무 강해 보이고 차가워 보이지만, 사실 너만큼 순수하고 엉뚱한 사람도 없어. 계산하고 머리 굴리는 걸 못 해. 그냥 들이받는 거지. 요령 피우거나 아부 떠는 걸 죽기보다 싫어해서, 사회생활 할 때 좀 손해 보지? 남들은 상사 비위 맞출 때 너는 굳은 표정으로 앉아 있잖아. "아닌 건 아닌 건데 왜 웃어야 해?" 하면서.

그리고 너, <span class='highlight'>말을 너무 아프게 해.</span> 남들이 빙빙 돌려 말할 때 핵직구 날려서 분위기 싸하게 만드는 재주가 있어. 본인은 "맞는 말이잖아? 다 널 위해서 하는 말이야"라고 생각하겠지만, 듣는 사람은 가슴에 구멍 뚫린다는 거 좀 알아줘. 너의 말은 도끼야. 휘두르기 전에 조심해야 해. 너는 거짓말을 못 해서 얼굴에 다 드러나.

특히 {my_branch_trait} 그래서 너는 더더욱 돌직구를 날리고, 네 맘에 안 들면 판을 엎어버리는 기질이 있어.

[너의 그림자: The Shadow]
너는 강해 보이지만, 사실 외로움을 엄청 많이 타. 의리 의리 외치는 것도 사실은 버림받기 싫어서 발버둥 치는 걸 수도 있어. 사람들이 너를 '센 사람'으로만 보고, 네 마음을 안 알아줄 때 넌 어린아이처럼 상처받지. 너의 내면엔 보살핌 받고 싶은 어린아이가 살고 있어.""",
            "dawn_mind": """"강함 뒤에 숨겨진 여린 마음."

새벽에 네가 하는 생각: "내가 너무 차갑게 말했나?" (X)
"왜 사람들은 쿨하지 못하고 찌질할까?" (O)

너는 후회 같은 거 잘 안 해. 하지만 네 단단한 바위 껍질 속에는, 누구보다 여리고 상처받기 쉬운 마음이 숨어 있어. 상처받기 싫어서, 배신당하기 싫어서 더 강한 척, 더 센 척 갑옷을 두르고 있는 거, 사실 너도 알고 있잖아.

너의 강함은 사실 '두려움의 반증'일지도 몰라. 누군가 네 갑옷을 뚫고 들어와서 너를 헤집어 놓을까 봐, 그래서 먼저 쳐내는 거지. 외롭지? 강한 척하는 거 힘들잖아. 이제 무거운 갑옷 좀 벗어도 돼. 너는 사실 눈물도 많고 정에 약한 사람이야. 슬픈 영화 보면 혼자 질질 짜잖아.""",
            "work_social": f""""혁명가 아니면 독재자."

너는 기존의 틀을 깨부수는 힘이 있어. 개혁하고, 바꾸고, 결단 내리는 일에 탁월해. 경찰, 군인, 법조계, 아니면 엔지니어링 같은 '각 잡힌' 일이 잘 어울려. 

게다가 {my_wolji}
그래서 너는 원칙을 중요하게 생각하고, 한번 정한 규칙은 끝까지 밀고 나가는 힘이 있어.

하지만 융통성이 없어서 팀원들을 힘들게 할 수 있어. "까라면 까" 식의 마인드가 좀 있거든. 네 추진력은 최고지만, 주변을 돌아보는 부드러움만 갖춘다면 너는 존경받는 리더가 될 거야. 너는 한번 목표를 정하면 불도저처럼 밀고 나가는 힘이 있어. 근데 방향이 틀리면 대형 사고가 나니까 조심해. 독재자가 되지 않으려면 귀를 열어야 해.""",
            "relationship": f""""내 사람은 내가 지킨다."

너를 휘어잡으려는 사람? 절대 못 만나. 네가 존경할 수 있는 압도적으로 '강한 사람'이거나, 아니면 아예 너한테 져주고 네가 지켜줄 수 있는 '순한 양' 같은 사람을 만나야 해.

어설프게 머리 굴리거나 밀당하는 사람 보면 딱 밥맛 떨어지잖아. 너는 투명하고 솔직한 사람에게 약해. 너의 거친 면까지 "귀엽네" 하고 받아줄 수 있는 사람을 만나야 네가 안정을 찾아. 

그래서 너는 연애할 때도 주도권을 쥐고 싶어 하고, 네 방식대로 상대를 이끌려고 해.

너는 내 사람을 건드리면 지옥 끝까지 쫓아가서 응징하는 든든한 보디가드 같은 애인이 되어줄 거야. 너의 사랑은 묵직하고 변함이 없어. 그리고 너는 침대 위에서도 정복욕이 강하지? 리드하는 걸 좋아하고, 상대가 나에게 압도당하는 모습에서 희열을 느껴.""",
            "advice": f"""지금 너는 무언가를 '정리'하거나 '결단'을 내려야 하는 시기일 수 있어. 맺고 끊는 건 네가 제일 잘하잖아.

종합적으로 해주고 싶은 말은, "너는 원석이야. 남들처럼 매끈한 보석이 되려고 너무 깎으려고만 하지 마." 네 거친 모습 그대로도 충분히 매력적이고 힘이 있어. 

다만 말 끝에 '쿠션' 좀 깔자. 팩트도 아프면 폭력이야. 그것만 고치면 넌 완벽해.

이런 투박함이 너의 매력이니까.

자, 이제 그 단단한 껍질을 깨고 나와볼까? 다음 [02:20 내 마음 현미경]에서 네 속마음을 들여다보자.""",
            "closing": "강한 척하느라 힘들었지? 갑옷 벗고 편안하게 쉬러 가자."
        },
        7: { # 신금
            "element": "💎 예민하고 날카로운 보석 (신금)",
            "keywords": ["#예민보스", "#차가운_나르시시스트", "#완벽주의적_자학"],
            "personality": f""""나는 특별해. 내가 대우받는 건 당연한 거야."

너는 자존심이 아니라 '자존감' 그 자체로 사는 사람이야. 너는 이미 세공이 끝난 반짝이는 보석(辛金)이라서, 더 이상 갈고 닦을 필요가 없어. 그냥 진열장에 놓여서 조명을 받고 감탄을 자아내야 하는 존재지.

그런데 남들이 너를 무시하거나, 네 자존심을 긁거나, 너를 하찮게 대우하면? 겉으론 우아하게 웃어넘길지 몰라도 속으론 이미 그 사람을 난도질하고 있어. "감히 네가 나를?"

너의 가장 무서운 무기는 <span class='highlight'>'소름 돋는 기억력'</span>이야. 3년 전에 서운했던 말, 날짜, 그때 그 사람의 미묘하게 비꼬던 표정, 말투까지 토씨 하나 안 틀리고 기억해내지. 너는 잊지 않아. 다만 갚아줄 타이밍을 기다릴 뿐. 너에게 한번 찍히면 살생부에 올라간 거나 마찬가지야.

옷 입는 센스나 말투도 남다르고, 지저분한 꼴을 못 보는 깔끔쟁이기도 해. 너는 너만의 높은 기준이 있어서, 그 기준에 못 미치는 사람이나 상황을 보면 견딜 수가 없어. "아, 왜 저렇게밖에 못 하지? 수준 떨어져." 그래서 늘 신경이 곤두서 있고 피곤한 거야. 세상이 네 기준만큼 완벽하지 않으니까. 너는 공주님/왕자님 병이 좀 있어. 근데 실제로 귀티가 나서 아무도 반박을 못 해.

**특히 {my_branch_trait}** 그래서 너는 남들보다 더 까칠하고 예민하게 굴면서도, 속으로는 외로워서 누군가 널 알아주길 바라고 있어.""",
            "dawn_mind": """"스스로를 찌르는 날카로운 칼날."

네 새벽이 괴로운 건 남 때문이 아니야. '스스로를 찌르고 있어서'야.

너는 남의 평가보다, 네가 세운 완벽한 기준에 도달하지 못한 너 자신을 못 견뎌해. 실수 하나라도 한 날에는 집에 와서 밤새 자책하지.

"난 왜 이것밖에 안 되지? 더 잘했어야 하는데. 멍청이. 바보."

하면서 스스로를 난도질하는 그 날카로운 칼날. 그게 너를 병들게 하고 있어. 남들은 네가 잘났다고 부러워하는데, 너는 너 자신이 늘 부족해 보이지? 너는 남한테는 관대할지 몰라도 너 자신에게는 지독하게 가혹해. 제발 그 칼날을 거둬. 너 아프잖아. 너는 존재 자체로 빛나는 보석이라는 걸 자꾸 까먹어.""",
            "work_social": f""""타협 없는 장인 정신."

너는 대충 하는 걸 못 해. 하나를 해도 완벽하게, 엣지 있게 해야 해. 그래서 결과물의 퀄리티는 보장되어 있지만, 과정에서 네 스트레스가 장난 아니야. 

남들이 네 결과물에 대해 지적하면 못 참지. "네가 뭘 안다고?"
너는 전문직, 디자이너, 의사, IT 개발자처럼 정밀하고 예리한 직업이 딱이야. 흙 묻히는 일은 싫어하니까, 깔끔하고 우아하게 일할 수 있는 곳을 찾아야 해. 

게다가 {my_wolji}
이런 기질 때문에 너는 디테일이 생명인 분야에서 탑을 찍을 수 있어.

너는 너만의 성역(Personal Space)이 있어서, 누가 거길 침범하면 견딜 수 없어해. 회사에서도 너는 혼자 일하는 걸 선호할 거야. 회식? 끔찍하게 싫어하지.""",
            "relationship": f""""내 옆에 서기에 부끄럽지 않은 사람."

눈 엄청 높지? 얼굴을 보든 능력을 보든, 내 옆에 세웠을 때 쪽팔리지 않은 사람이어야 해. 너의 악세사리가 되어줄 수 있을 만큼 빛나는 사람을 원해. 너의 심미안을 만족시키지 못하면 이성으로 안 느껴지잖아.

그리고 너는 차가워 보여도 내 사람한텐 헌신적인데, 그만큼 바라는 것도 많아. "내가 이만큼 해줬으면 너도 알아서 기어야지"라는 보상심리가 연애를 힘들게 해. 사랑은 거래가 아니잖아. 너의 그 날카로운 예민함을 다 받아줄 수 있는 멘탈 강한(혹은 무던한) 사람 아니면 너랑 오래 못 가. 

그래서 너는 연애할 때도 상대방을 분석하고 평가하는 버릇이 있어.

너는 예민한 만큼 '감각'도 발달해서, 침대 위에서도 까다롭지만 한번 만족하면 엄청난 몰입을 보여주지? 너는 더럽고 땀 냄새나는 건 질색이야. 깨끗하고 아름다운 사랑을 원해.""",
            "advice": f"""지금 너는 '예민함이 극에 달한 시기'일 수 있어. 작은 소리, 빛, 냄새에도 짜증이 날지도 몰라.

종합적으로 해주고 싶은 말은, "너는 이미 완성된 보석이야. 굳이 증명하려 애쓰지 않아도 빛나." 제발 좀 둥글게 살아. 너무 날이 서 있으면 아무도 널 못 안아줘. 다치니까. 

이런 예민함 때문에 스스로를 찌르지 마.

가끔은 흐트러진 모습도 보여줘. 그래야 사람들이 너에게 다가갈 수 있어. 완벽하지 않아도 사랑스러워.""",
            "closing": "날카로운 신경을 잠시 내려놓고, 가장 편안한 네 모습을 찾아보자."
        },
        8: { # 임수
            "element": "🌊 깊이를 알 수 없는 겨울 밤바다 (임수)",
            "keywords": ["#천재적_지략가", "#속을_모르는_사람", "#마이웨이_개인주의"],
            "personality": f""""나는 생각한다. 고로 존재한다. 근데 생각 좀 그만하고 싶다."

너는 스케일이 달라. 생각하는 것도, 꿈꾸는 것도 넓은 바다 같아. 어디든 흘러갈 수 있는 유연함이 있지만, 아무도 네 바닷속 깊은 곳에 뭐가 있는지 몰라. 너조차도 모를 때가 많으니까.

너는 겉으로는 "하하 호호" 잘 어울리는 '인싸' 같지만, 사실은 '철저하게 혼자만의 시간이 필요한 개인주의자'야. 사람들 틈에 섞여 있어도 너는 항상 한 발짝 물러서서 관망하고 있는 느낌? 마치 남들 머리 꼭대기 위에 앉아있는 것 같아.

잔머리랑 임기응변은 네가 전교 1등일걸. 위기 상황이 닥치면 남들은 당황하는데, 너는 본능적으로 빠져나갈 구멍을 찾아내. 가끔은 그런 네가 계산적이고 음흉해 보일 수도 있지만, 그건 네가 너무 똑똑해서 그래. 남들이 1을 볼 때 너는 10을 보고 있으니까. 너는 세상을 체스판처럼 보고 수를 두는 사람이야. 너는 절대 손해 보는 선택을 하지 않아.

[너의 그림자: The Shadow]
너는 '음란마귀'가 씌어 있어. 밤의 에너지가 강하거든. 겉으로는 점잖은 척하지만 속으로는 가장 야한 생각을 하고 있을지도 몰라. 특히 {my_branch_trait} 그래서 너의 그 이중적인 모습이 가끔은 위험해 보일 때도 있어. 그리고 너는 남을 조종하는 걸 즐겨. 내가 직접 움직이기보단 남을 움직여서 내 목적을 달성하는 흑막 같은 기질이 있지.""",
            "dawn_mind": """"깊은 심해 속의 허무주의."

너는 머리가 너무 좋아서 탈이야. 새벽이면 꼬리에 꼬리를 무는 생각들 때문에 뇌가 멈추질 않지?

철학적인 고민, 우주의 원리, 죽음이란 무엇인가... 그러다 갑자기 내일 점심 메뉴까지. 너의 생각은 끝이 없어. 너는 남들보다 너무 앞서 생각해서 우울해지는 경향이 있어. 모르는 게 약일 때도 있는데, 너는 다 꿰뚫어 보니까 세상이 시시하고 허무하게 느껴지는 거야.

"다들 아등바등 사네... 어차피 죽으면 끝인데. 이게 다 무슨 의미가 있나."

이런 허무주의가 너를 잠식하지 않게 조심해야 해. 너의 우울은 깊은 심해와 같아서, 한번 빠지면 나오기 힘들어. 너는 생각이 멈추는 순간을 가장 편안하게 느끼지만, 그런 순간은 거의 오지 않지.""",
            "work_social": f""""자유로운 영혼의 전략가."

너는 9 to 6 칼출근, 꽉 막힌 조직 생활 못 해. 숨 막혀서 죽을걸? 기획, 아이디어, 무역, 해외 관련 일처럼 스케일 크고 자유로운 일을 해야 해. 

게다가 {my_wolji}
이런 성향 덕분에 너는 남들보다 넓은 시야로 세상을 바라보고, 큰 그림을 그리는 능력이 탁월해.

너는 '빅 픽처'를 그리는 사람이라 세부적인 실행은 좀 약해. 귀찮아하거든. 그래서 네 옆에는 네 아이디어를 현실로 만들어줄 성실한 파트너가 필요해. 너는 아이디어만 던지고 "자, 나머진 네가 해" 하는 스타일이잖아. 너는 물처럼 유연해서 어디든 섞일 수 있지만, 그릇에 담기는 건 싫어해. 너는 얽매이는 순간 도망쳐버려.""",
            "relationship": f""""날 구속하려 하지 마."

구속하는 거 제일 싫어하지? 흐르는 물을 누가 막겠어. 너를 가두려 하는 순간 너는 틈새로 빠져나가 증발해버릴 거야. "어디야? 누구랑 있어?" 이런 질문 받는 순간 정이 뚝 떨어지지.

너는 외모보다 '뇌가 섹시한 사람'에게 미쳐. 대화가 안 통하거나 멍청해 보이면 1분도 같이 있기 싫어하잖아. 티키타카가 되고, 네가 던지는 심오한 농담(혹은 섹드립)을 받아칠 수 있는 사람. 너의 깊은 우울과 어둠까지 이해해 줄 수 있는 넓은 사람을 만나야 해. 

그래서 너는 연애할 때도 너만의 독특한 세계관을 이해해 줄 사람을 찾아 헤매지.

너의 복잡한 머릿속을 유일하게 쉬게 해 줄 사람. 너는 '낮져밤이(낮에는 지고 밤에는 이기는)' 스타일일 확률이 높아. 밤에는 네가 지배자가 되고 싶어 하니까.""",
            "advice": f"""지금 너는 '깊은 생각의 늪'에 빠져있을 수 있어. 생각이 행동을 막고 있는 상태.

종합적으로 해주고 싶은 말은, "너무 깊게 들어가지 마. 심해에는 빛이 안 들어와." 생각이 꼬리를 물면 우울해질 뿐이야. 가끔은 그냥 수면 위에 둥둥 떠서 멍때리는 '단순함'이 너를 살릴 거야. 머리 쓰지 말고 몸을 써. 땀 흘리고 단순하게 웃는 게 너에겐 최고의 처방약이야.

이런 생각들이 널 잡아먹게 두지 마.""",
            "closing": "깊은 생각의 바다에서 나와, 따뜻한 모닥불 곁으로 와."
        },
        9: { # 계수
            "element": "☔ 조용히 스며드는 봄비 (계수)",
            "keywords": ["#감수성_폭발", "#아이디어_뱅크", "#종잡을수없는_변덕"],
            "personality": f""""나는 네가 뭘 원하는지 다 알아. 말하지 않아도."

너는 '안개'나 '봄비' 같아. 있는 듯 없는 듯 조용하지만, 어느새 주변을 다 적시고 장악해버리지. 너는 힘으로 누르는 게 아니라, '감성으로 스며드는 사람'이야.

아이디어가 샘솟고 머리 회전이 빨라서, 리더 옆에서 전략 짜주는 '참모' 역할에 딱이야. 작은 틈새만 있어도 스며드는 물처럼, 너는 사람의 마음을 읽고 파고드는 능력이 탁월해. 눈치가 빠르다 못해 독심술 수준이지.

근데 <span class='highlight'>감정 기복이 미친 롤러코스터야.</span> 비 오는 날 창밖 보면서 청승 떠는 거 좋아하고, 남들은 이해 못 할 사소한 포인트에서 혼자 상처받고 마음의 문을 걸어 잠그지. 어제는 좋았다가 오늘은 싫었다가... 너는 네가 맑은지 흐린지 너 자신도 모를 때가 많지? 너의 변덕을 맞출 수 있는 사람은 세상에 몇 없을 거야. 너는 작은 옹달샘 같아서, 돌멩이 하나만 던져도 파문이 크게 일어.

특히 {my_branch_trait} 그래서 너는 혼자만의 세계가 더 깊고, 남들은 상상도 못 할 독특한 생각을 품고 있어.

[너의 그림자: The Shadow]
너는 '피해자 코스프레'를 잘해. 불리하면 약한 척, 아픈 척해서 상황을 모면하는 재주가 있어. 그리고 남의 비밀을 캐내는 건 좋아하면서, 네 비밀은 절대 말 안 하지? 너는 속을 절대 안 보여주는 능구렁이 같은 면이 있어.""",
            "dawn_mind": """"고해상도로 느끼는 세상의 피로함."

너는 '일어나지 않은 일에 대한 걱정'으로 밤을 새워. 상상력이 너무 풍부해서 최악의 상황까지 시뮬레이션을 돌려야 직성이 풀리지.

"만약에 그러면 어떡하지? 아, 망하면 어쩌지? 걔가 나 싫어하면 어쩌지?"

네가 예민한 게 아니라, 세상을 남들보다 더 섬세하게, **고해상도**로 느끼는 거야. 그래서 더 피곤한 거고. 작은 소리, 냄새, 분위기 변화 하나하나가 너에게는 정보로 들어오니까 뇌가 쉴 틈이 없는 거지. 너의 뇌는 24시간 풀가동 중인 레이더 같아. 좀 꺼도 되는데. 너는 남들이 무심코 뱉은 말을 혼자 확대 해석해서 상처받는 천재야.""",
            "work_social": f""""창의력 대장, 멘탈은 쿠크다스."

너는 기획력, 창의력이 미쳤어. 남들이 생각지도 못한 걸 만들어내지. 하지만 끈기가 좀 부족해. 싫증을 빨리 느끼거든. 그리고 누가 뭐라 하면 상처받아서 일을 그만두고 싶어 해.

게다가 {my_wolji}
이런 성향 덕분에 너는 톡톡 튀는 아이디어로 주목받지만, 끈기 있게 마무리하는 힘은 조금 부족할 수 있어.

너는 경쟁이 치열한 곳보다는, 네 능력을 인정해 주고 우쭈쭈 해주는 곳에서 일해야 능력을 발휘해. 칭찬은 고래도 춤추게 하지만, 계수(癸水)인 너는 날아다니게 만들어. 너는 조용히 강한 사람이야. 티 내지 않고 뒤에서 판을 짜는 설계자. 너는 절대 전면에 나서지 않아. 뒤에서 조종하는 게 더 편하거든.""",
            "relationship": f""""너와 나는 하나가 되고 싶어."

너는 모성애, 부성애 자극하는 스타일이야. 왠지 챙겨줘야 할 것 같고, 보호 본능을 일으키지. 너도 사랑받고 확인받는 걸 중요하게 생각해서, 연락 안 되면 불안해 미쳐버릴걸?

너는 '공감 능력'이 너무 뛰어나서 문제야. 상대방의 감정을 스펀지처럼 흡수해서, 애인이 우울하면 너도 같이 땅 파고 들어가는 '동기화' 능력이 있어. 감정 쓰레기통이 되지 않게 조심해. 너는 사랑을 하면 그 사람 자체가 되어버리려고 해. 헌신적이지만, 그만큼 상처도 잘 받아. 너는 작은 선물이나 말 한마디에도 감동하지만, 작은 실수에도 실망해서 마음을 닫아버려. 그리고 너는 성적인 판타지가 꽤나 독특하고 풍부하지?""",
            "advice": f"""네 걱정의 90%는 안 일어날 일이야. 그 좋은 상상력을 걱정하는 데 쓰지 말고, 글을 쓰거나 그림을 그려봐. 넌 타고난 예술가 기질이 있거든. 

이런 상상력을 낭비하지 마.

남들 감정 그만 흡수하고, 네 감정이나 챙겨.""",
            "closing": "요동치는 감정의 파도, 이제는 잔잔하게 만들어줄게."
        }
    }
    
    return {
        "element": saju_db[stem_idx]["element"],
        "keywords": saju_db[stem_idx]["keywords"],
        "personality": saju_db[stem_idx]["personality"],
        "dawn_mind": saju_db[stem_idx]["dawn_mind"],
        "work_social": saju_db[stem_idx]["work_social"],
        "relationship": saju_db[stem_idx]["relationship"],
        "advice": saju_db[stem_idx]["advice"],
        "closing": saju_db[stem_idx]["closing"]
    }

# ==============================================
# [메뉴 1] 02:00 메인 로비
# ==============================================
def main_page():
    st.title("🌙 새벽 2시 상담소")
    st.image("https://images.unsplash.com/photo-1495423234853-27c1b5a5c5a0?w=800&q=80")
    st.markdown("""
    <div class="report-card">
        <div class="report-title">잠들지 못하는 너에게</div>
        <div class="report-content">
        낮에는 괜찮은 척 웃어넘겼지만, 
        새벽만 되면 스멀스멀 올라오는 생각들에 잠 못 이루고 있진 않니?<br><br>
        여기는 그런 너를 위한 <b>새벽 2시의 틈새</b>야.<br>
        남들 시선 신경 쓸 필요 없이, 오직 너에게만 집중해 봐.<br><br>
        순서대로 따라가도 좋고, 마음 가는 시간에 멈춰도 좋아.<br>
        자, 이제 왼쪽 메뉴에서 <b>[02:10]</b>부터 시작해볼까?
        </div>
    </div>
    """, unsafe_allow_html=True)

# ==============================================
# [메뉴 2] 02:10 사주 (최종 심층 분석)
# ==============================================
def page_210():
    st.title(" 02:10_나의 타고난 기질")
    st.caption("생년월일 하나면 충분해. 너의 무의식까지 꿰뚫어볼게.")
    st.markdown("---")
    
    st.info("💡 TIP: 양력 생일을 정확하게 입력해줘. (태어난 시간은 몰라도 돼!)")
    
    with st.form("saju_form"):
        col1, col2, col3 = st.columns(3)
        with col1: year = st.number_input("태어난 년도", 1950, 2025, 2000)
        with col2: month = st.number_input("월", 1, 12, 1)
        with col3: day = st.number_input("일", 1, 31, 1)
        
        submit = st.form_submit_button("내 본캐 결과 깊게 파보기 🔓")
    
    # 결과 영역을 위한 컨테이너 미리 생성
    result_container = st.empty()

    if submit:
        target_date = datetime.date(int(year), int(month), int(day))
        result = get_saju_analysis(target_date)
        
        with st.spinner("하늘의 별자리와 너의 생일을 대조하는 중..."):
            time.sleep(1.5)

        # 결과는 컨테이너에 안전하게 기록
        with result_container.container():
            st.markdown(f"### 📜 너는 [{result['element']}] 의 기운을 타고났어.")
            
            # 1. 핵심 키워드
            st.markdown(f"""
            <div class="keyword-box">
                <span class="keyword-tag">{result['keywords'][0]}</span>
                <span class="keyword-tag">{result['keywords'][1]}</span>
                <span class="keyword-tag">{result['keywords'][2]}</span>
            </div>
            """, unsafe_allow_html=True)
            
            # 2. 상세 리포트 (안정화된 분할 렌더링)
            st.markdown(f"""
            <div class="report-card">
                <div class="report-title">👤 가면 뒤에 숨겨진 진짜 너</div>
                <div class="report-content">{result['personality']}</div>
            </div>
            """, unsafe_allow_html=True)
            
            st.markdown(f"""
            <div class="report-card" style="border-left-color: #7048e8;">
                <div class="report-title">🌙 새벽 2시, 네가 잠 못 드는 진짜 이유</div>
                <div class="report-content">{result['dawn_mind']}</div>
            </div>
            """, unsafe_allow_html=True)
            
            st.markdown(f"""
            <div class="report-card" style="border-left-color: #20c997;">
                 <div class="report-title">💼 일과 사회생활 (Work & Money)</div>
                 <div class="report-content">{result['work_social']}</div>
            </div>
            """, unsafe_allow_html=True)
            
            st.markdown(f"""
            <div class="report-card" style="border-left-color: #fa5252;">
                <div class="report-title">❤️ 소름 돋는 연애 패턴</div>
                <div class="report-content">{result['relationship']}</div>
            </div>
            """, unsafe_allow_html=True)
            
            # 찐친 조언 (디자인 수정됨 - 따뜻한 박스 형태)
            st.markdown(f"""
            <div class="advice-box">
                <div class="report-title" style="border-bottom:none; margin-bottom:10px;">💌 지금, 너에게 해주고 싶은 말</div>
                <div style="font-size:1.05rem;">{result['advice']}</div>
            </div>
            """, unsafe_allow_html=True)
            
            # 마무리 멘트 (심플 텍스트)
            st.markdown(f"""
            <div class="closing-text">
                {result['closing']}
            </div>
            """, unsafe_allow_html=True)

# ==============================================
# [메뉴 3] 02:20 내 마음 현미경 (종합 심리 검사 - 버튼형)
# ==============================================
def page_220():
    st.title(" 02:20_내 마음 현미경")
    
    # ---------------------------------------------------------
    # [핵심 수정 1] 검사 초기화(Reset) 기능 - 가장 먼저 실행!
    # ---------------------------------------------------------
    # 만약 결과가 이미 있다면, 상단에 '다시 하기' 버튼을 보여줍니다.
    if 'user_night_type' in st.session_state:
        st.info("💡 이미 검사 결과가 있어. 새로운 마음으로 다시 하려면 아래 버튼을 눌러줘.")
        
        if st.button("🔄 검사 기록 싹 지우고 다시 하기", type="primary"):
            # 1. 세션에 저장된 모든 키를 가져옵니다.
            all_keys = list(st.session_state.keys())
            
            # 2. 우리 검사와 관련된 키만 골라서 삭제합니다.
            for key in all_keys:
                # 'q_'로 시작하는(라디오버튼 답) 키 or 결과 키 or 문제DB 키
                if key.startswith("q_") or key == 'user_night_type' or key == 'mind_test_db':
                    del st.session_state[key]
            
            # 3. 페이지를 강제로 새로고침하여 초기화된 상태로 만듭니다.
            st.rerun()

    st.caption("지금 내 마음은 어떤 계절을 지나고 있을까?")
    st.markdown("---")

    # 1. 인트로 & 주의사항
    st.markdown("""
    <div class="report-content">
    이곳은 병원이 아닙니다. 그저 당신의 마음이 어떤 모양인지 그려보는 곳이에요.<br>
    총 <b>42개의 질문</b>이 준비되어 있어. 순서는 <b>랜덤</b>으로 섞여 있으니까,<br>
    머리로 계산하지 말고 마음이 시키는 대로 솔직하게 답해줘.<br><br>
    ⚠️ <b>[안내]</b><br>
    본 문항과 결과는 <b>웰니스 자가체크 목적</b>의 구성이며, 특정 심리검사를 기반으로 한 진단 도구가 아닙니다.<br>
    이 결과는 의료적 진단이나 치료를 대신할 수 없으며, 스스로를 관찰하고 돌보기 위한 참고용으로만 활용해 주세요.
    </div>
    """, unsafe_allow_html=True)

    # 2. 질문 데이터베이스 생성 (없을 때만 생성)
    if 'mind_test_db' not in st.session_state:
        questions = [
            # 1. 마음의 습도 (우울)
            {"cat": "moisture", "q": "일을 할 때 예전만큼 즐겁지 않고, 성과를 내고 싶은 의욕이 생기지 않는다."},
            {"cat": "moisture", "q": "긍정적인 감정이 잘 들지 않고, 하루 전반에 활기가 부족하다고 느낀다."},
            {"cat": "moisture", "q": "평소보다 깊게 잠들지 못하고, 한밤중에 깨는 일이 잦은 편이다."},
            {"cat": "moisture", "q": "밤에 한 번 깨면 다시 잠드는 데 시간이 꽤 오래 걸린다."},
            {"cat": "moisture", "q": "최근 들어 사소한 일에도 피로감이 느껴지고, 쉽게 지친다."},
            {"cat": "moisture", "q": "예전만큼 스스로에게 만족하지 못하고, 기대만큼 행동하지 못한다고 느낀다."},

            # 2. 안테나 감도 (HSP)
            {"cat": "sensitivity", "q": "일상에서 빛, 소리 같은 감각이 강하게 느껴지면, 몸이나 마음이 쉽게 피로해질 때가 있다."},
            {"cat": "sensitivity", "q": "다른 사람의 감정을 자주 살피고, 그에 쉽게 영향을 받는 편이다."},
            {"cat": "sensitivity", "q": "처리해야 할 일이 한꺼번에 몰리면, 시간 압박 때문에 조급해지거나 불안해진다."},
            {"cat": "sensitivity", "q": "카페인이 들어있는 음료를 마시면, 평소보다 예민해지고 반응이 크게 느껴질 때가 있다."},
            {"cat": "sensitivity", "q": "배고플 때 평소보다 주변에 민감하게 반응하고, 집중력이 흐트러진다."},
            {"cat": "sensitivity", "q": "특정한 음악이나 그림을 접했을 때, 감정이 깊게 동요되거나 여운이 오래 남는 편이다."},

            # 3. 어깨의 중력 (스트레스)
            {"cat": "pressure", "q": "일상이 계획대로 흘러가지 않고, 예상치 못한 일이 생기면 급격하게 에너지가 소모된다."},
            {"cat": "pressure", "q": "내 뜻대로 일이 풀리지 않을 때가 있다."},
            {"cat": "pressure", "q": "사소한 일에도 마음이 쉽게 흔들리고 부담을 느낀다."},
            {"cat": "pressure", "q": "해야 할 일은 많지만, 다 해낼 수 있을지 걱정된다."},
            {"cat": "pressure", "q": "일에 집중하기 어렵고, 주어진 일을 제대로 해내지 못한다고 느낀다."},

            # 4. 고슴도치 지수 (대인예민성)
            {"cat": "defense", "q": "다른 사람들이 내 행동이나 말에 대해 안 좋게 평가할까 걱정된다."},
            {"cat": "defense", "q": "다른 사람의 시선에 신경이 쓰인다."},
            {"cat": "defense", "q": "다른 사람과 비교했을 때, 내가 부족하다고 느낄 때가 있다."},
            {"cat": "defense", "q": "다른 사람의 친절을 그대로 받아들이기 어렵다."},
            {"cat": "defense", "q": "사소한 일에도 감정이 요동치고, 서운함을 느낀다."},

            # 5. 마음의 스프링 (회복탄력성)
            {"cat": "resilience", "q": "문제가 생겨도 마음을 가다듬고 다시 시작할 수 있다."},
            {"cat": "resilience", "q": "일이 뜻대로 풀리지 않더라도 나름의 장점을 찾으려고 한다."},
            {"cat": "resilience", "q": "실수한 경험을 통해 얻은 깨달음도 중요하게 여긴다."},
            {"cat": "resilience", "q": "마음이 답답할 때 이를 해소할 수 있는 루틴이 있다."},
            {"cat": "resilience", "q": "다가올 상황에 대해 걱정하기 보다는 가능성과 희망을 생각한다."},

            # 6. 새벽 각성도 (수면/불면)
            {"cat": "insomnia", "q": "침대에 누워도 잠드는 데 오래 걸려 밤이 길게 느껴진다."},
            {"cat": "insomnia", "q": "자다가 자주 깨는 일이 잦아, 충분한 휴식을 취하지 못한다."},
            {"cat": "insomnia", "q": "평소보다 일찍 깨서 다시 잠들기가 힘들고, 남은 수면을 채우기 어렵다."},
            {"cat": "insomnia", "q": "수면이 충분하지 않아 하루 일과에 지장이 생긴다."},
            {"cat": "insomnia", "q": "평소 수면 패턴이 잘 맞지 않아 신경 쓰인다."},

            # 7. 생활의 리듬 (루틴)
            {"cat": "routine", "q": "정해진 수면 루틴이 없어, 매일 기상/취침 시간 변동이 크다."},
            {"cat": "routine", "q": "일정한 식사 패턴을 유지하지 못하고, 몰아서 먹는 경우가 많다."},
            {"cat": "routine", "q": "씻기나 정리 등 일상적인 일을 하는 게 번거롭게 느껴진다."},
            {"cat": "routine", "q": "낮에는 에너지가 부족하고 의욕이 떨어지지만, 밤에는 활발해진다."},
            {"cat": "routine", "q": "예정된 약속을 실행하기보다 취소하는 것이 더 편하게 느껴질 때가 있다."},

            # 8. 감정 해상도 (감정식별)
            {"cat": "resolution", "q": "내가 느끼는 감정을 단어로 나타내거나 적절한 말을 찾기 어렵다."},
            {"cat": "resolution", "q": "내가 느끼는 감정을 스스로 판단하고 구분하기 힘들다."},
            {"cat": "resolution", "q": "기분의 변화보다는 몸의 신호(통증 등)에 의해 내 기분을 판단하는 편이다."},
            {"cat": "resolution", "q": "내 감정을 다른 사람과 공유하는 것이 쉽지 않다."},
            {"cat": "resolution", "q": "감정을 자극하는 장면을 보더라도 다른 사람처럼 감정적으로 강하게 공감하지 못하는 편이다."}
        ]
        random.shuffle(questions)
        st.session_state.mind_test_db = questions

    # 3. 설문 진행
    with st.form("mind_microscope_form"):
        st.write(" ")
        options = ["전혀 그렇지 않다", "그렇지 않다", "보통이다", "그렇다", "매우 그렇다"]
        score_map = {"전혀 그렇지 않다": 1, "그렇지 않다": 2, "보통이다": 3, "그렇다": 4, "매우 그렇다": 5}
        
        user_answers = {}

        # 질문 출력 (st.session_state['q_...'] 키를 사용하여 상태 관리)
        for i, item in enumerate(st.session_state.mind_test_db):
            st.markdown(f"**Q{i+1}.** {item['q']}")
            
            # 라디오 버튼의 key는 유니크해야 함 (q_0, q_1...)
            ans = st.radio(
                label="답변 선택",
                options=options,
                index=2, # 기본값 '보통이다'
                key=f"q_{i}", 
                horizontal=True,
                label_visibility="collapsed"
            )
            
            user_answers[i] = {"cat": item['cat'], "score": score_map[ans]}
            st.markdown("---")

        submit = st.form_submit_button("내 마음 날씨 확인하기 🌦️")

    # 4. 결과 분석 및 출력
    if submit:
        # 점수 계산
        scores = {
            "moisture": 0, "sensitivity": 0, "pressure": 0, "defense": 0,
            "resilience": 0, "insomnia": 0, "routine": 0, "resolution": 0
        }
        
        for ans in user_answers.values():
            scores[ans['cat']] += ans['score']

        # ---------------------------------------------------------
        # [핵심 수정 2] 가장 시급한 타입 찾기 (찐친 모드 로직)
        # ---------------------------------------------------------
        final_check = scores.copy()
        
        # 회복탄력성 보정 (높을수록 좋음 -> 낮을수록 위험하게 뒤집기)
        # 30점 만점 기준
        final_check['resilience'] = 30 - final_check['resilience']

        # 가장 점수가 높은(위험한) 타입 선정
        worst_type = max(final_check, key=final_check.get)

        # ★ 중요: 세션에 결과 저장
        st.session_state['user_night_type'] = worst_type
        
        # [디버깅용] - 나중에 삭제 가능
        # 아래 코드를 주석 해제하면 실제로 점수가 바뀌는지 눈으로 볼 수 있음
        # st.write("---")
        # st.write("📊 점수판 확인(개발자용):", final_check)
        # st.write("🎯 선정된 타입:", worst_type)
        # st.write("---")

        st.success("분석이 완료되었어! 아래로 내려서 결과를 확인해 봐.")
        time.sleep(0.5)

        # ---------------------------------------------------------
        # 결과 해설 화면 출력
        # ---------------------------------------------------------
        st.markdown("## 📋 마음 현미경 분석 결과")
        st.caption("지금 너의 마음 상태를 날씨와 풍경으로 그려봤어.")
        st.write("")

        # 1. 💧 마음의 습도 (우울)
        s = scores["moisture"]
        st.markdown("### 1. 💧 마음의 습도")
        if s <= 10: st.info(f"[상태: 맑음 ☀️]\n\n지금 너의 마음은 꽤 쾌적하고 안정적이야. 가끔 구름이 지나갈 순 있지만, 금방 햇살이 비칠 만큼 회복력이 좋아.")
        elif s <= 20: st.warning(f"[상태: 흐림 ☁️]\n\n마음에 먹구름이 조금 드리워져 있어. 일상은 소화하고 있지만, 왠지 모르게 무기력하고 웃을 일이 적어졌네.")
        else: st.error(f"[상태: 장마 ☔]\n\n긴 장마처럼 마음이 축 젖어 있어. 모든 게 물먹은 솜처럼 무겁고, 아무것도 하고 싶지 않을 거야. 약해서가 아니라, 마음이 지독한 감기에 걸린 거야.")

        # 2. 📡 안테나 감도 (HSP)
        s = scores["sensitivity"]
        st.markdown("### 2. 📡 안테나 감도")
        if s <= 10: st.info(f"[성향: 무던함 🛡️]\n\n너는 외부 자극에 크게 흔들리지 않는 튼튼한 방패를 가졌어.")
        elif s <= 20: st.warning(f"[성향: 적당함 🌿]\n\n필요할 땐 섬세하게 느끼고, 아닐 땐 흘려보낼 줄 아는 균형 잡힌 감각을 가졌어.")
        else: st.error(f"[성향: 초고감도 ⚡]\n\n너의 안테나는 성능이 너무 좋아서 탈이야. 빛, 소리, 감정까지 전부 수신하다 보니 금방 방전되지. 혼자만의 충전이 필수야.")

        # 3. 🗿 어깨의 중력 (스트레스)
        s = scores["pressure"]
        st.markdown("### 3. 🗿 어깨의 중력")
        if s <= 8: st.info(f"[무게: 깃털 🪶]\n\n지금 너의 어깨는 아주 가벼워. 스트레스 관리를 잘하고 있네.")
        elif s <= 17: st.warning(f"[무게: 배낭 🎒]\n\n적당한 무게의 짐을 지고 걷는 중이네. 약간의 압박감은 있지만, 가끔 내려놓고 쉬어줘.")
        else: st.error(f"[무게: 바위 🪨]\n\n조심해, 감당하기 벅찬 무게야. '내가 다 해야 해'라는 생각이 너를 짓누르고 있어. 짐을 좀 덜어내야 해.")

        # 4. 🦔 고슴도치 지수 (대인예민성)
        s = scores["defense"]
        st.markdown("### 4. 🦔 고슴도치 지수")
        if s <= 8: st.info(f"[상태: 편안함 ☁️]\n\n타인의 시선에서 자유롭고, 있는 그대로의 나를 보여주는 데 두려움이 없어.")
        elif s <= 17: st.warning(f"[상태: 경계 🌵]\n\n가끔은 욱하고, 가끔은 눈치를 보며 가시를 세우곤 해. 상처받기 싫은 방어 본능이야.")
        else: st.error(f"[상태: 예민함 🐡]\n\n지금 너는 온몸의 가시를 바짝 세우고 있어. 상처받는 게 무서워서 미리 벽을 치는 거야.")

        # 5. 🏀 마음의 스프링 (회복탄력성)
        s = scores["resilience"]
        st.markdown("### 5. 🏀 마음의 스프링")
        if s <= 8: st.error(f"[탄성: 취약 🧶]\n\n마음의 근육이 약해져 있어. 작은 실패에도 주저앉기 쉬워. 지금은 천천히 걷는 연습부터 하자.")
        elif s <= 17: st.warning(f"[탄성: 평균 ⚽]\n\n넘어져도 다시 튀어 오를 줄 아는 건강한 마음이야. 힘들 땐 주저앉아 울기도 하지만 결국 일어나는 힘이 있어.")
        else: st.info(f"[탄성: 강함 🚀]\n\n정말 대단한데? 시련을 겪을수록 더 단단해지는 마음을 가졌어. 넌 결국 이겨낼 거야.")

        # 6. 👀 새벽 각성도 (수면)
        s = scores["insomnia"]
        st.markdown("### 6. 👀 새벽 각성도")
        if s <= 8: st.info(f"[수면: 양호 🌙]\n\n밤이 되면 스위치가 꺼지듯 편안하게 잠들고 있구나. 아주 좋아.")
        elif s <= 17: st.warning(f"[수면: 불편 🐑]\n\n자려고 누우면 잡생각이 들거나 자꾸 깨네. '잘 자야 하는데'라는 강박을 좀 내려놔.")
        else: st.error(f"[수면: 부족 🦉]\n\n밤새 뇌가 깨어있어 괴로운 상태야. 밤이 무서워지는 단계라면 생활 습관 점검이 필요할 수도 있어.")

        # 7. ⏰ 생활의 리듬 (루틴)
        s = scores["routine"]
        st.markdown("### 7. ⏰ 생활의 리듬")
        if s <= 8: st.info(f"[리듬: 규칙적 🕰️]\n\n너의 하루는 꽤나 규칙적이야. 이 안정적인 루틴이 너를 지탱하는 힘이야.")
        elif s <= 17: st.warning(f"[리듬: 보통 🎷]\n\n가끔은 규칙적이다가 가끔은 밤낮이 바뀌네. 최소한의 기상 시간은 지키는 게 좋아.")
        else: st.error(f"[리듬: 불규칙 🌪️]\n\n생활 패턴이 엉켜 있어. 몸의 리듬이 깨지면 마음도 무너져. 이불 개기 같은 작은 것부터 시작해.")

        # 8. 🔎 감정 해상도 (감정식별)
        s = scores["resolution"]
        st.markdown("### 8. 🔎 감정 해상도")
        if s <= 8: st.info(f"[해상도: 명확함 📺]\n\n'이건 불안이 아니라 설렘이구나' 하고 정확히 알기 때문에 감정에 휩쓸리지 않아.")
        elif s <= 17: st.warning(f"[해상도: 보통 🎥]\n\n대략적인 기분은 알지만, 복잡 미묘한 감정은 헷갈릴 때가 있어.")
        else: st.error(f"[해상도: 혼란 🌫️]\n\n지금 네 마음은 안개 낀 것처럼 흐릿해. 내가 왜 힘든지 도무지 모르겠고 답답하기만 해.")

        st.markdown("---")
        st.markdown("""
        <div class="advice-box" style="text-align: center;">
        <b>🌙 [새벽의 위로]</b><br>
        결과가 좋게 나왔든, 조금 흐리게 나왔든<br>
        자신의 마음을 들여다보려고 노력한 너는 이미 괜찮아질 준비가 된 사람이야.<br>
        오늘 밤은 걱정 내려놓고 푹 쉬길 바랄게.
        </div>
        """, unsafe_allow_html=True)

import random # 상단에 없다면 추가 필요

# ==============================================
# [메뉴 4] 02:30 나만의 처방전 (랜덤 편지 버전)
# ==============================================
def page_230():
    st.title(" 02:30_밤의 처방전")
    st.caption("잠 못 드는 너의 머리맡에 두고 가는 편지.")
    st.markdown("---")

    # 1. 검사 결과 확인
    if 'user_night_type' not in st.session_state:
        st.warning("✋ 잠깐만! 너 아직 마음 검사 안 했잖아.")
        st.info("왼쪽 메뉴에서 [02:20 내 마음 현미경] 먼저 하고 와. 너한테 딱 맞는 처방 내려줄게.")
        return

    # 2. 데이터 로드
    user_type = st.session_state['user_night_type']
    
# -------------------------------------------------------------------
    # [데이터베이스] 찐친의 장문 편지 (8타입 x 3버전 = 24개)
    # -------------------------------------------------------------------
    prescriptions = {
        "moisture": {  # 1. 우울 (마음의 습도)
            "type_name": "💧 축 젖은 솜이불 같은 밤",
            "letters": [
                # Ver 1. 위로 (따뜻함)
                """
                야, 오늘 하루 숨 쉬는 것조차 무겁게 느껴졌지? 남들은 다들 멀쩡하게 웃으면서 사는 것 같은데, 나만 물속에 잠겨서 허우적거리는 기분. 카톡 하나 답장하는 것도, 밥 한 끼 챙겨 먹는 것도 숙제처럼 느껴졌을 거야. 근데 있잖아, 그거 네가 게을러서 그런 거 절대 아니야. 네 마음이 지금 긴 장마철을 지나고 있어서 그래.

                솜이불이 물을 잔뜩 머금으면 천하장사도 못 드는 법이야. 지금 네 마음이 딱 그래. 눈에 보이지 않는 눈물과 감정들을 잔뜩 머금고 있어서 축 처지는 게 당연한 거라고. 그러니까 제발 "난 왜 이렇게 의지가 약할까", "남들은 갓생 사는데 난 쓰레기야" 하면서 스스로를 괴롭히지 마. 

                비가 억수같이 쏟아지는데 밖에서 뛰어다니는 사람은 없어. 지금은 그냥 처마 밑에서 비가 그칠 때까지 멍하니 앉아 있어도 되는 시간이야. 젖은 옷 좀 입고 있으면 어때. 내가 옆에서 우산 들고 같이 서 있어 줄게. 억지로 마르려고 애쓰지 말고, 그냥 오늘 하루 버텨낸 너 자신한테 "고생했다"고 딱 한 마디만 해주라. 진짜 고생했으니까.
                """,
                # Ver 2. 팩폭 (현실적 조언)
                """
                지금 침대에 누워서 핸드폰만 보면서 "아, 뭐라도 해야 하는데..." 생각만 하고 있지? 씻기도 귀찮고, 내일이 오는 것도 싫고, 그냥 이대로 증발해버렸으면 좋겠고. 근데 친구야, 냉정하게 말해서 우울은 '에너지 파업'이야. 네 몸이랑 뇌가 "더 이상은 못 해먹겠다! 배째라!" 하고 드러누운 거라고.

                파업 중인 공장에 억지로 기계 돌리면 어떻게 되는지 알아? 고장 나. 지금 네가 억지로 몸 일으키려고 해봤자 번아웃만 더 심하게 올 뿐이야. 이럴 땐 협상을 해야 해. "오케이, 인정. 나 지금 상태 메롱임. 그러니까 오늘은 딱 숨만 쉰다." 하고 쿨하게 인정해버려.

                대단한 거 하려고 하지 마. 그냥 밥 한 숟가락 먹었으면 성공. 화장실 다녀왔으면 대성공. 웹툰 보고 웃었으면 기적. 이렇게 기준을 바닥까지 낮춰. 네가 지금 무기력한 건 에너지를 충전하고 있다는 증거니까, 죄책감 갖지 말고 그냥 푹 퍼져 있어. 충전기가 꽂혀야 다시 켜질 거 아냐. 오늘 밤은 자책 금지다. 알겠지?
                """,
                # Ver 3. 감성 (깊은 이해)
                """
                비 오는 날 버스 창가에 앉으면 세상이 흐릿하게 뭉개져 보이잖아. 지금 네가 보는 세상이 딱 그럴 거야. 미래는 안개 낀 것처럼 뿌옇고, 과거의 후회들은 빗물처럼 자꾸 흘러내리고. 마음의 창문에 김이 서려서 앞이 잘 안 보이는 거지. 그래서 불안하고, 어디로 가야 할지 몰라서 덜컥 겁이 나는 걸 거야.

                근데 나는 네가 가진 그 우울함이 마냥 나쁜 거라고 생각 안 해. 남들보다 깊이 가라앉을 수 있다는 건, 그만큼 남들이 못 보는 바닥의 보석을 볼 수 있다는 뜻이기도 하니까. 지금의 이 눅눅한 시간들이 지나고 나면, 너는 타인의 아픔을 누구보다 깊게 이해하는 사람이 되어 있을 거야.

                김 서린 창문에는 낙서하기 딱 좋잖아. 지금의 이 답답한 마음을 억지로 닦아내려 하지 말고, 그냥 그 위에 네 감정을 흘러가는 대로 둬 봐. 울고 싶으면 실컷 울어. 눈물은 마음의 독소를 뺀다는 증거니까. 충분히 젖고 나면, 언젠가 반드시 뽀송뽀송하게 마르는 날이 올 거야. 그때까지 내가 네 빨래집게가 되어 줄게.
                """
            ],
            "recipe_title": "🛌 침대 위 셀프 허그",
            "recipe_steps": [
                "이불 속에서 웅크리고 누워봐. 태아처럼 가장 편안한 자세로.",
                "양손을 비벼서 따뜻하게 만든 다음, 차가워진 네 배나 가슴 위에 가만히 올려둬.",
                "네 손바닥의 온기가 심장까지 전해지는 걸 느끼면서, 3분 동안만 가만히 있어 봐. '따뜻하다'고 느끼면 된 거야."
            ],
            "youtube_key": "비오는 숲속 오두막 빗소리"
        },

        "sensitivity": {  # 2. 예민 (안테나 감도)
            "type_name": "📡 안테나가 터질 것 같은 밤",
            "letters": [
                # Ver 1. 위로
                """
                오늘 하루도 눈치 보느라 에너지 다 썼구나. 남들은 그냥 "어, 그래?" 하고 무심하게 넘기는 말 한마디, 짓궂은 농담, 미묘하게 변하는 표정까지... 너는 그 모든 걸 나노 단위로 분석하고 해석하느라 머리가 터질 것 같지? 집에 오면 녹초가 돼서 말할 힘도 없는 그 기분, 내가 알아.

                제발 "내가 너무 예민한가? 성격이 이상한가?" 하면서 자책 좀 하지 마. 너는 이상한 게 아니라, 남들보다 성능이 압도적으로 좋은 '고해상도 센서'를 장착하고 태어난 것뿐이야. 남들이 2G폰으로 세상을 볼 때, 너 혼자 4K 화질로 세상을 보니까 당연히 데이터 소모가 빠르고 배터리가 빨리 닳을 수밖에 없지.

                네가 느끼는 그 섬세함 덕분에 누군가는 위로받았을 거고, 너만이 발견한 아름다움도 있었을 거야. 그러니까 오늘 밤은 그 비싼 센서의 전원을 좀 끄자. 세상의 모든 소음, 타인의 시선, 평가... 다 차단하고 오직 '나'의 숨소리에만 집중해. 지금부터는 네가 편한 게 법이고, 네가 느끼는 게 정답이야.
                """,
                # Ver 2. 팩폭
                """
                야, 솔직히 까놓고 말해서 아까 그 상황, 걔는 아무 생각 없었을걸? 너 혼자 밤새 시나리오 쓰고, 연출하고, 비련의 여주인공까지 맡아서 북 치고 장구 치고 있는 거야. 네 상상력이 풍부한 건 인정하는데, 제발 그 능력을 너 스스로를 괴롭히는 데 쓰지 좀 마. 너무 아깝잖아.

                네가 느낀 그 불길한 예감, "저 사람이 나 싫어하나?" 하는 걱정, 90%는 틀려. 그리고 만약에 맞으면 뭐 어쩔 건데? 걔가 너 싫어하면 너도 걔 싫어하면 그만이야. 왜 너는 모든 사람한테 사랑받으려고 하고, 모든 상황을 통제하려고 하냐? 그거 욕심이야.

                지금 당장 방 불 끄고, 스마트폰 뒤집어 놔. SNS 보면서 남들 사는 거 염탐하지 말고. 정보가 너무 많이 들어오니까 네 뇌가 과부하 걸려서 윙윙거리는 소리 안 들려? 지금 너에게 필요한 건 분석이 아니라 '강제 종료'야. 생각 그만하고 그냥 자. 내일 일은 내일의 네가 알아서 수습할 거야.
                """,
                # Ver 3. 감성
                """
                세상이 너한테는 너무 시끄러운 곳이지? 꽉 막힌 도로의 경적 소리, 지하철의 퀴퀴한 냄새, 무례하게 선을 넘는 사람들의 말투... 너처럼 투명하고 얇은 피부를 가진 사람에게 이 도시는 매일매일이 전쟁터일 거야. 가만히 있어도 베이고, 스치기만 해도 멍이 드니까.

                네가 유난스러운 게 아니야. 세상이 너무 거칠고 무례한 거야. 너의 그 섬세함은 예술가가 가져야 할 축복인데, 현실에서는 자꾸 약점처럼 취급받아서 속상했지? 하지만 나는 네가 가진 그 예민함이 좋아. 너는 남들이 못 듣는 빗소리의 리듬을 듣고, 남들이 못 보는 노을의 색깔을 볼 수 있잖아.

                오늘 밤만큼은 내가 너만의 방음벽이 되어줄게. 아무도 너를 건드리지 못하게, 어떤 소음도 너를 찌르지 못하게 막아줄게. 너는 그냥 깊고 고요한 바닷속으로 가라앉기만 하면 돼. 여기는 중력도 없고 소음도 없어. 안전해. 아무도 널 해치지 않아. 긴장 풀어.
                """
            ],
            "recipe_title": "👂 고요한 귀 마사지",
            "recipe_steps": [
                "검지 손가락으로 양쪽 귓구멍을 꾹 막아봐. 세상 소리가 '우웅-' 하고 차단될 거야.",
                "그 상태로 눈을 감고 10초 동안 내 몸 안에서 울리는 숨소리를 들어봐.",
                "손을 떼고, 귓바퀴를 위아래로 부드럽게 문지르면서 긴장을 풀어줘. 뇌가 시원해질 거야."
            ],
            "youtube_key": "심해 무중력 백색소음"
        },

        "pressure": {  # 3. 스트레스 (어깨의 중력)
            "type_name": "🗿 어깨에 곰 세 마리 얹은 밤",
            "letters": [
                # Ver 1. 위로
                """
                지금 침대에 누워서도 어깨에 힘 빡 들어가 있지? 턱에 힘주고 이 악물고 있지는 않아? "이거 해야 하는데", "아까 그거 실수한 거 아닌가?", "내일 상사한테 깨지면 어떡하지?" 머릿속에는 해야 할 일 리스트가 빽빽하고, 잘해야 한다는 압박감이 목을 조르는 기분일 거야.

                너는 책임감이 정말 강한 사람이야. 그래서 남한테 피해 주는 걸 죽기보다 싫어하고, 맡은 일은 어떻게든 완벽하게 해내려고 하잖아. 그게 너의 장점이지만, 가끔은 그 책임감이 너를 너무 외롭게 만드는 것 같아 안쓰러워. "힘들다"고 말하면 무너질까 봐 꾹 참고 있는 거 다 알아.

                근데 친구야, 오늘 하루 실수 좀 했으면 어때? 세상 안 무너져. 그리고 네가 걱정하는 그 일들의 대부분은 일어나지도 않을 일들이야. 너는 이미 충분히 잘하고 있어. 내가 보증해. 그러니까 제발 오늘 밤은 그 무거운 배낭 좀 현관에 던져버리고 와. 지금은 '책임'지는 시간이 아니라, 네 몸을 '충전'해야 하는 시간이야.
                """,
                # Ver 2. 팩폭
                """
                야, 세상 짐 너 혼자 다 짊어지고 사냐? 네가 아틀라스야? 하늘 무너질까 봐 받치고 있게? 너 없어도 회사는 잘 돌아가고, 학교도 잘 돌아가고, 지구도 잘 돌아가. 네가 잠깐 쉰다고 해서 큰일 날 것 같지? 착각하지 마. 세상은 생각보다 너한테 관심 없어.

                너는 "완벽해야 한다"는 강박증 때문에 너 스스로를 지옥으로 몰아넣고 있어. 70점만 맞아도 합격인데, 굳이 100점 맞겠다고 밤새우다가 병나면 그게 무슨 소용이야? 가끔은 "에라 모르겠다, 될 대로 돼라" 하는 배짱도 필요해. 

                지금 네 어깨가 뭉치고 뒷목이 뻐근한 건, 몸이 보내는 마지막 경고 신호야. "주인놈아, 나 좀 살려줘!" 하고 비명 지르는 거라고. 오늘 밤은 뇌 빼고 그냥 멍청하게 있어. 계획 세우지 마. 반성하지 마. 내일 걱정은 내일의 네가 알아서 하겠지. 오늘의 너는 그냥 자빠져 자는 게 일이야.
                """,
                # Ver 3. 감성
                """
                타닥타닥... 모닥불 타는 소리 들어본 적 있어? 장작은 자기를 태워서 빛과 열을 내잖아. 너를 보면 꼭 그 장작 같아. 주변 사람들을 밝혀주고 따뜻하게 해주려고, 정작 너 자신은 하얗게 재가 될 때까지 태우고 있는 것 같아서.

                열심히 사는 건 멋진 일이지만, 재가 되어버리면 다시 불을 붙일 수가 없어. 네 불꽃이 꺼지지 않으려면, 가끔은 땔감을 더 넣지 말고 그냥 은은한 숯불 상태로 쉬게 둬야 해. 지금의 휴식은 게으름이 아니라, 더 오래 타오르기 위한 '불 조절' 시간이라고 생각하자.

                오늘 밤은 네가 짊어진 짐, 기대, 시선... 다 내려놓고 가벼운 연기가 되어 날아가는 상상을 해봐. 너는 무엇이 되지 않아도, 무엇을 해내지 않아도 그 자체로 충분히 따뜻한 사람이야. 애쓰지 않아도 돼. 그냥 존재만으로도 넌 가치 있어.
                """
            ],
            "recipe_title": "🌬️ 4-7-8 호흡 (강제 이완)",
            "recipe_steps": [
                "침대에 누워서 어깨를 귀까지 으쓱! 올렸다가 '툭' 하고 힘없이 떨궈봐. (3번 반복)",
                "4초 동안 코로 숨을 깊게 들이마셔.",
                "7초 동안 숨을 참아. (긴장을 모으는 거야)",
                "8초 동안 입으로 '후~' 하고 내뱉어. 몸이 침대 속으로 녹아내린다고 상상해."
            ],
            "youtube_key": "장작 타는 소리 불멍 ASMR"
        },

        "defense": {  # 4. 대인예민 (고슴도치 지수)
            "type_name": "🦔 가시 세우느라 지친 밤",
            "letters": [
                # Ver 1. 위로
                """
                오늘 누군가 네 마음을 할퀴고 지나갔니? 아니면 "그 사람이 나를 어떻게 생각할까?" 하는 생각에 이불 킥 하고 있어? 상처받기 싫어서 하루 종일 뾰족한 가시를 세우고, 레이더를 켜고, 경계 태세로 있느라 진이 다 빠졌겠다.

                사람이 제일 무서운데, 또 사람이 제일 그립고... 외로운 건 싫은데 다가오는 건 부담스러운 그 모순된 마음. 그거 진짜 힘들지. 나도 알아. 네가 원래 차가운 사람이어서가 아니라, 마음이 너무 여려서 다칠까 봐 겁이 나는 거잖아.

                근데 여기는 안전해. 내 앞에서는 그 무거운 철갑옷 벗어던져도 아무도 너 안 찔러. 너는 사실 누구보다 여리고 따뜻한 속살을 가진 사람이잖아. 그 예쁜 마음이 더 이상 다치지 않게, 오늘 밤은 내가 보초 서 줄게. 이불 속으로 쏙 들어가. 거기가 세상에서 제일 안전한 네 벙커야.
                """,
                # Ver 2. 팩폭
                """
                너 지금 또 "걔가 아까 나한테 왜 그랬지?", "내가 뭐 실수했나?" 하면서 혼자 소설 쓰고 있지? 야, 꿈 깨. 남들은 네 생각만큼 너한테 관심 없어. 다들 자기 먹고살기 바쁘고, 자기 코가 석 자야. 

                너는 타인의 시선을 너무 의식해. 마치 CCTV가 너를 24시간 감시하고 있다고 생각하는 것 같아. 그래서 행동 하나하나 검열하고, 쿨한 척 연기하고... 안 피곤하냐? 그렇게 남 눈치 보며 산다고 걔네가 너한테 상 주나?

                네 인생의 주인공은 너야. 엑스트라들이 뒤에서 떠드는 소리에 신경 끄고, 네 대본이나 잘 챙겨. 미움받을 용기? 거창한 거 필요 없어. 그냥 "어쩌라고, 난 내가 제일 소중해" 하는 뻔뻔함이 필요해. 가시 좀 내리고 편하게 누워. 너 안 찔러. 쫄지 마.
                """,
                # Ver 3. 감성
                """
                고슴도치 딜레마라고 들어봤지? 추워서 서로 안아주고 싶은데, 가까이 가면 가시에 찔려서 아프고, 멀어지면 춥고. 지금 네 마음이 딱 그럴 것 같아. 누군가의 온기가 필요한데, 또다시 상처받을까 봐 두려워서 뒷걸음질 치고 있는 모습.

                네가 세운 그 가시들은 사실 "나 좀 안아줘, 근데 아프게 하지 마"라는 소리 없는 비명일지도 몰라. 네가 얼마나 사람을 좋아하고, 믿고 싶어 하는지 나는 알아. 단지 그 믿음이 깨졌을 때의 고통을 너무 잘 알기에 주저하는 것뿐이지.

                하지만 친구야, 가시 돋친 채로도 널 안아줄 사람은 분명히 있어. 네 가시 사이사이 빈틈을 찾아서 조심스럽게 다가와 줄 사람. 그때까지만 잠시 숨을 고르자. 오늘 밤은 굳이 누군가를 이해하려 하지 말고, 그냥 혼자만의 고요함 속에 숨어도 돼. 그것도 나쁘지 않아.
                """
            ],
            "recipe_title": "⛺ 이불 속 벙커 (안전지대)",
            "recipe_steps": [
                "가장 부드러운 이불을 머리 끝까지 뒤집어써.",
                "눈을 감고 내가 지금 튼튼한 동굴이나 캡슐 안에 들어와 있다고 상상해.",
                "작게 속삭여 봐. '여기는 안전해. 아무도 못 들어와.' 이 말이 주문처럼 널 지켜줄 거야."
            ],
            "youtube_key": "비행기 기내 소음 화이트노이즈"
        },

        "resilience": {  # 5. 회복탄력성 (마음의 스프링)
            "type_name": "🏀 마음이 찌그러진 밤",
            "letters": [
                # Ver 1. 위로
                """
                한번 구겨진 종이가 다시 안 펴지는 것처럼, 마음이 자꾸 꼬이기만 하지? 옛날에는 툭 털고 일어났던 일들도 이제는 데미지가 크게 오고, "난 왜 이렇게 멘탈이 약할까", "예전엔 안 그랬는데" 하며 스스로를 갉아먹고 있네.

                야, 너 약한 거 아니야. 아무리 튼튼한 스프링이라도, 무거운 돌덩이를 몇 년 동안 올려두면 튀어 오르지 못하는 게 당연한 이치야. 지금 너는 탄성을 잃은 게 아니라, 너무 오랫동안 짓눌려 있었던 거야. 

                지금 억지로 펴려고 하지 마. 억지로 "할 수 있다!" 외치지 마. 지금은 그냥 눌린 채로 찌그러져 있어도 돼. 충분히 쉬고, 무거운 짐을 치우고 나면, 너는 보란 듯이 다시 튀어 오를 거야. 너는 원래 그런 놈이니까. 네 안에 있는 스프링은 아직 녹슬지 않았어. 잠시 쉬고 있을 뿐이야.
                """,
                # Ver 2. 팩폭
                """
                너 지금 "난 망했어, 다시 못 일어날 거야" 하면서 땅 파고 들어가고 있지? 실패한 것 같고, 뒤처진 것 같고, 이번 생은 글른 것 같고. 근데 그거 알아? 넘어진 김에 쉬어간다는 말, 그거 진짜 명언이야.

                너는 넘어지는 걸 너무 무서워해. 한 번 넘어지면 끝장이라고 생각하니까 몸에 힘이 들어가고, 그래서 더 크게 다치는 거야. 야, 넘어져도 안 죽어. 무릎 좀 까지고 피 좀 나면 어때? 딱지 앉고 새살 돋겠지.

                지금 네가 겪는 이 시련? 나중엔 술안주 거리도 안 돼. "그땐 그랬지" 하면서 웃으면서 이야기할 날 온다. 그러니까 엄살 그만 부리고, 오늘은 그냥 푹 자. 내일 아침에 일어나서 맛있는 거나 사 먹어. 밥심으로 버티다 보면 멘탈도 돌아오게 돼 있어.
                """,
                # Ver 3. 감성
                """
                공이 바닥을 치는 순간은 아프지만, 다시 튀어 오르기 위해선 반드시 바닥이 필요해. 지금 네가 바닥을 치고 있다고 느낀다면, 그건 추락이 아니라 도약을 위한 준비 동작일 거야.

                마음에도 근육이 있어서, 찢어지고 아물기를 반복해야 더 단단해진대. 지금 네가 느끼는 이 쓰라림은 마음의 근육통 같은 거야. 더 넓고 깊은 마음을 가지기 위한 성장통. 그러니까 너무 겁먹지 마.

                오늘 밤은 네 상처를 억지로 꿰매려 하지 말고, 그냥 바람이 통하게 둬. 아픈 건 아픈 거고, 슬픈 건 슬픈 거야. 그 감정들을 충분히 느껴줘야 빨리 나아. 너는 반드시 다시 튀어 오를 거야. 그 어떤 공보다 높게. 나는 네 탄성을 믿어.
                """
            ],
            "recipe_title": "🦋 나비 포옹 (셀프 위로)",
            "recipe_steps": [
                "두 팔을 교차해서 네 양쪽 어깨를 감싸 안아봐. (스스로를 안아주는 자세)",
                "눈을 감고 왼쪽, 오른쪽 번갈아 가며 천천히 어깨를 토닥여줘.",
                "토닥일 때마다 속으로 말해줘. '고생했다. 버티느라 진짜 애썼다. 괜찮다.'"
            ],
            "youtube_key": "치유 주파수 528Hz 음악"
        },

        "insomnia": {  # 6. 불면 (새벽 각성도)
            "type_name": "👀 눈만 말똥말똥한 올빼미 밤",
            "letters": [
                # Ver 1. 위로
                """
                "아, 미치겠네. 지금 자야 내일 출근하는데..." 시계를 볼 때마다 심장이 쿵 떨어지고, 억지로 눈을 감으면 잡생각 파티가 열리지? "양 한 마리, 양 두 마리..." 세다 보면 양들이 춤추고 난리 났을 거야. 그 강박이 너를 더 못 자게 괴롭히고 있어.

                지금 네 뇌는 "자야 해!"라는 명령을 "긴장해! 비상이야!"라고 잘못 알아듣고 각성 상태를 유지하고 있는 거야. 오늘 하루 네가 너무 열심히 살아서, 뇌가 퇴근 버튼 누르는 걸 까먹은 거지.

                야, 그냥 오늘 잠자기는 글렀다 셈치고 맘 편하게 먹어. 자려고 노력하지 마. 대신 '눈 감고 멍하니 쉬는 것'만 목표로 해. 누워서 눈만 감고 있어도 수면의 80% 효과가 있대. 진짜야. 밑져야 본전이잖아. 이 고요한 밤을 그냥 즐겨버려. 너를 괴롭히는 그 생각들, 내일 아침이면 별거 아닐 거야.
                """,
                # Ver 2. 팩폭
                """
                너 지금 스마트폰 보면서 "잠 안 온다"고 검색하고 있지? 블루라이트를 그렇게 눈에 쏴대는데 잠이 오겠냐? 멜라토닌이 나오려다가도 "앗, 낮인가 봐!" 하고 도망가겠다.

                그리고 너, 낮에 커피 몇 잔 마셨어? 햇빛은 좀 봤어? 몸은 하나도 안 움직이고 머리만 굴리니까 몸이 피곤한 줄 모르는 거야. 육체가 피곤해야 기절하듯 잠드는 법인데, 너는 지금 정신만 과로 상태고 몸은 멀쩡하니까 눈이 말똥말똥한 거라고.

                지금 당장 폰 끄고 던져버려. 정 심심하면 지루한 책을 읽거나, 영어 단어를 외워. 침대는 자는 곳이지 폰 보는 곳이 아니야. 뇌한테 "여기 누우면 자는 거야"라고 교육을 다시 시켜야 해. 오늘 못 자면 내일 좀 피곤하면 되지, 안 죽어. 쫄지 말고 눈 감아.
                """,
                # Ver 3. 감성
                """
                밤은 원래 생각의 계절이야. 낮 동안 억눌려 있던 감정들이 별처럼 떠오르는 시간이지. 네가 잠 못 드는 건, 어쩌면 네 마음속에 하고 싶은 말이 너무 많아서일지도 몰라. 풀지 못한 숙제들, 전하지 못한 말들, 잊혀지지 않는 얼굴들...

                억지로 잠을 청하기보다, 그 생각들을 하나씩 꺼내서 잘 다독여주는 건 어떨까? "그래, 너 그때 힘들었지", "그래, 너 그때 참 좋았지" 하고 인사해 주고 보내주는 거야. 생각과 싸우면 더 잠이 달아나지만, 생각과 화해하면 잠이 찾아올 거야.

                이 밤은 길지만, 반드시 아침은 와. 네가 깨어있는 이 시간도 너의 인생의 일부야. 너무 미워하지 마. 창문 틈으로 들어오는 달빛을 이불 삼아, 오늘 밤은 네 생각들과 평화 협정을 맺어봐. 잘 자, 내 친구.
                """
            ],
            "recipe_title": "🔥 손바닥 눈 찜질 (암전)",
            "recipe_steps": [
                "양 손바닥을 20초 동안 불이 날 정도로 빠르게 비벼봐. 뜨끈해질 때까지!",
                "따뜻해진 손바닥을 오목하게 만들어서 눈 위에 살포시 덮어. (누르지는 말고)",
                "눈앞이 깜깜해지면서 눈 주변 근육이 사르르 녹는 느낌에만 집중해. 1분만 있어도 하품 날걸?"
            ],
            "youtube_key": "수면 유도 델타파 음악"
        },

        "routine": {  # 7. 생활리듬 (루틴)
            "type_name": "⏰ 시계바늘이 꼬여버린 밤",
            "letters": [
                # Ver 1. 위로
                """
                낮밤 바뀌고, 밥때 놓치고... 생활이 엉망이라 "난 왜 이 모양일까", "의지박약이야" 하면서 자책하고 있지? 에이, 살다 보면 그럴 수도 있지. 네가 원래 밤의 에너지를 사랑하는 올빼미형 인간이라 그래. 예술가들이 원래 다 그래.

                규칙적인 삶이 꼭 정답은 아니야. 하지만 지금 네 몸이 좀 힘들어하니까 신호는 줘야지. 몸은 언제 자고 언제 먹어야 할지 몰라서 혼란스러운 상태거든. 시차 적응 실패한 사람처럼 멍하고 소화도 안 되고 그럴 거야.

                거창하게 "내일부터 아침형 인간!" 이런 계획 세우지 마. (어차피 작심삼일 될 거 알잖아?) 대신 딱 하나, 몸한테 "오늘 영업 끝났어"라고 알려주는 마침표만 찍어줘. 그것만 해도 몸은 "아, 이제 쉬는구나" 하고 안심할 거야.
                """,
                # Ver 2. 팩폭
                """
                너 오늘도 "내일부터 일찍 일어나야지" 다짐만 하고 지금 이 시간까지 깨어있지? 그리고 내일 점심때 일어나서 "아, 망했다" 하고 또 후회할 거고. 이 패턴 지겹지도 않냐? 네 인생의 절반이 후회로 채워지고 있어.

                불규칙한 생활은 네 자존감을 갉아먹는 주범이야. 아침에 눈 떴을 때의 개운함 대신 패배감을 먼저 맛보게 하니까. 야, 그냥 지금 자. "이것만 보고 자야지" 하는 그 마음이 너를 망치는 거야.

                내일 아침에 좀비처럼 일어나더라도 일단 햇빛을 봐. 그리고 밤 12시 전에는 무조건 폰 끄고 누워. 네 생체리듬은 네가 고쳐야지 누가 고쳐줘? 엄마도 이제 포기했어. 네 스스로 통제하는 맛을 좀 느껴봐. 생각보다 꽤 짜릿해.
                """,
                # Ver 3. 감성
                """
                모든 것에는 리듬이 있어. 파도도 밀려왔다 쓸려가고, 달도 찼다가 기울잖아. 지금 너의 리듬이 조금 헝클어진 건, 어쩌면 네 인생의 변주곡이 연주되고 있는 중일지도 몰라. 너무 불안해하지 마.

                하지만 불협화음이 계속되면 연주자가 지치기 마련이야. 다시 아름다운 선율을 연주하기 위해선, 잠시 쉬표가 필요해. 엉킨 실타래를 억지로 풀려 하면 더 꼬이지만, 가만히 두면 느슨해지는 것처럼.

                오늘 밤은 너의 하루에 정중하게 마침표를 찍어줘. "오늘 하루도 수고했어, 이제 문 닫습니다."라고. 그 마침표가 내일 아침, 새로운 문장의 시작점이 되어줄 거야. 네 템포대로 천천히 돌아와도 돼. 기다릴게.
                """
            ],
            "recipe_title": "🛑 영업 종료 의식",
            "recipe_steps": [
                "하던 폰질, 걱정, 생각 전부 멈추고 베개를 끌어안아.",
                "베개 냄새를 깊게 들이마시고 내쉬기를 3번 천천히 반복해.",
                "마지막 숨을 내쉬면서 입 밖으로 작게 말해. '오늘 하루 영업 종료. 수고했어.' 이게 네 몸의 전원 버튼이야."
            ],
            "youtube_key": "규칙적인 괘종시계 소리"
        },

        "resolution": {  # 8. 감정해상도 (감정식별)
            "type_name": "🔎 마음이 체한 것 같은 밤",
            "letters": [
                # Ver 1. 위로
                """
                가슴이 답답하고 명치가 꽉 막힌 것 같은데 이유를 모르겠지? 슬픈 건지, 화난 건지, 불안한 건지... 그냥 고구마 100개 먹은 느낌일 거야. 이거 '감정 급체'야. 네가 평소에 "괜찮아, 별거 아니야" 하면서 감정들을 억지로 삼키고 무시하다가 결국 체한 거라고.

                지금 당장 이유 찾으려고 머리 쓰지 마. 체했을 때 억지로 먹으면 토하잖아. 분석하려고 들면 더 아파. 그냥 "아, 내가 지금 좀 답답하구나", "내가 지금 울고 싶구나" 하고 그 사실만 인정해 줘.

                이름 모를 감정도 다 네 일부야. 쫓아내려고 하지 말고, 미워하지 말고, 그냥 옆에 가만히 앉혀둬. "그래, 너도 내 마음이지" 하고 토닥여주면, 딱딱하게 굳어있던 마음이 조금씩 녹아내릴 거야. 소화제는 시간이 해결해 줄 테니까 걱정 마.
                """,
                # Ver 2. 팩폭
                """
                너 지금 네 기분이 어떤지도 모르지? 그냥 "짜증 나", "몰라" 이 두 단어로 퉁치고 있잖아. 네 감정 어휘력이 유치원생 수준으로 떨어진 거야. 왜냐고? 네가 네 마음을 들여다보는 걸 게을리했으니까.

                남들 눈치는 그렇게 잘 보면서 정작 네 속이 썩어가는 건 모른 척했잖아. 회피한다고 해결되는 거 없어. 지금 그 답답함은 네 마음이 "나 좀 봐줘! 나 여기 있어!" 하고 시위하는 거야. 언제까지 모른 척할 거야?

                지금 당장 종이 꺼내서 써봐. "쪽팔리다", "서운하다", "비참하다", "질투 난다". 이렇게 날것의 감정에 이름을 붙여. 인정하는 순간 쪽팔림은 사라지고 해결책이 보여. 네 마음의 주인은 너잖아. 도망가지 말고 직면해.
                """,
                # Ver 3. 감성
                """
                마음속에 안개가 낀 것처럼 뿌옇고 답답하지? 내가 어디 서 있는지, 저 앞에 절벽이 있는지 꽃밭이 있는지 알 수 없어서 두려울 거야. 하지만 안개는 언젠가 걷혀. 그리고 안개 속에서는 평소에 보지 못했던 것들이 보이기도 해.

                지금 네가 느끼는 이 모호한 감정들은, 물감들이 섞이고 있는 과정일지도 몰라. 아직 무슨 색인지 정의할 수 없지만, 섞이고 나면 너만의 고유한 색깔이 나오겠지. 

                억지로 이름을 붙이려 하지 말고, 그냥 그 색깔들을 가만히 바라봐 줘. 회색이어도 좋고, 검은색이어도 좋아. 네 마음이라는 캔버스에 칠해진 그 모든 색이 너라는 사람을 깊고 아름답게 만들어줄 거야. 너는 지금 너를 알아가는 여행 중인 거야.
                """
            ],
            "recipe_title": "🎨 뇌내 색칠 공부 (시각화)",
            "recipe_steps": [
                "눈을 감고 지금 네 기분을 색깔로 떠올려봐. (탁한 회색? 시뻘건 색?)",
                "머릿속 도화지에 그 색깔 페인트를 냅다 들이부어. 빈틈없이 꽉 채워.",
                "색이 꽉 차면, 시원한 소나기가 쏴아- 쏟아지면서 그 색깔이 씻겨 내려가 투명해지는 상상을 해."
            ],
            "youtube_key": "몽환적인 엠비언트 뮤직"
        }
    }

# (위쪽 데이터 선언부 생략...)
    
    # 3. 데이터 선택 (랜덤 로테이션 로직)
    data = prescriptions[user_type]
    
    letters_list = data['letters']
    if isinstance(letters_list, str): 
        letters_list = [letters_list]
        
    selected_letter = random.choice(letters_list)

    # -------------------------------------------------------------------
    # [수정된 부분] 텍스트 공백 제거 및 HTML 변환 로직
    # -------------------------------------------------------------------
    
    # 1. 코드상의 들여쓰기 공백 제거 (textwrap.dedent 사용)
    clean_letter = textwrap.dedent(selected_letter).strip()
    
    # 2. 줄바꿈(\n)을 HTML 줄바꿈(<br>)으로 변환
    formatted_letter = clean_letter.replace('\n', '<br>')

    # -------------------------------------------------------------------
    # [UI 디자인] 깔끔하게 수정된 버전
    # -------------------------------------------------------------------

    st.markdown(f"### 🌙 {data['type_name']}")
    st.write("") 

    # 편지글 (HTML 구조 단순화)
    st.markdown(f"""
    <div style="
        background-color: #f8f9fa; 
        padding: 30px; 
        border-radius: 10px; 
        border-left: 5px solid #ced4da;
        font-family: 'Pretendard', sans-serif;
        line-height: 1.8;
        color: #495057;
        font-size: 1.05rem;">
        {formatted_letter}
    </div>
    """, unsafe_allow_html=True)
    
    st.caption("▲ 이건 내가 너를 위해 쓴 편지야. (올 때마다 내용이 바뀔 수도 있어!)")
    st.write("") 
    st.markdown("---")

    # 처방전
    st.subheader(f"💊 {data['recipe_title']}")
    st.markdown("욕실 갈 필요도 없어. 지금 누운 그 자세 그대로 이것만 해보자.")
    
    st.info(f"""
    Step 1. {data['recipe_steps'][0]}  
    Step 2. {data['recipe_steps'][1]}  
    Step 3. {data['recipe_steps'][2]}
    """)
    
    st.write("")
    st.markdown("---")

    # 음악 추천
    col1, col2 = st.columns([2, 1])
    
    with col1:
        st.markdown(f"🎧 이 밤의 BGM")
        st.caption(f"네가 잠들 때까지 내가 옆에서 이 소리 틀어줄게.  \n유튜브에 '{data['youtube_key']}' 검색하면 나와.")
        
    with col2:
        youtube_url = f"https://www.youtube.com/results?search_query={data['youtube_key']}"
        st.link_button("▶ 소리 들으러 가기", youtube_url, type="secondary", use_container_width=True)

    st.write("")
    st.markdown("""
    <div style="text-align: center; color: #adb5bd; font-size: 0.8em; margin-top: 50px;">
    오늘 밤은 나쁜 꿈 꾸지 마. 잘 자. 🌙
    </div>
    """, unsafe_allow_html=True)
import random
import time

import streamlit as st
import time
import random


# ==============================================
# [메뉴 5] 02:40 쉬어가는 타임 (밤바다 + 눈치 챙긴 키워드 매칭)
# ==============================================
def page_240():
    st.title(" 02:40_밤바다 산책")
    st.caption("잠 못 드는 밤, 파도 소리 들으러 왔어.")
    st.markdown("---")

    # ------------------------------------------------------------------
    # [기능] 키워드 기반 맞춤형 위로 함수 (돈 안 드는 수동 AI)
    # ------------------------------------------------------------------
    def get_smart_comfort_message(text):
        # 1. 메시지 데이터베이스 (상황별 분류)
        messages = {
            # [상황 1] 실수, 실패, 자책 ("망했다", "실수", "바보" 등)
            'failure': [
                "실수 좀 하면 어때? 누구나 처음은 다 서툰 법이야.",
                "오늘의 실수는 내일의 너를 더 단단하게 만들어줄 거름이야.",
                "너무 자책하지 마. 넌 로봇이 아니잖아.",
                "한 번 넘어졌다고 인생이 끝나는 거 아니야. 다시 일어나면 돼.",
                "지금은 실패 같아 보여도, 지나고 보면 하나의 에피소드일 뿐이야.",
                "완벽하지 않아도 돼. 빈틈이 있어야 그 사이로 빛이 들어오거든.",
                "이미 벌어진 일은 파도에 흘려보내자. 넌 충분히 만회할 수 있어.",
                "그 실수 하나가 너라는 사람 전체를 정의하지 않아. 기죽지 마."
            ],
            # [상황 2] 인간관계, 상처 ("사람", "친구", "상사", "싸움", "말" 등)
            'relationship': [
                "모든 사람에게 좋은 사람이 될 필요는 없어. 너 자신에게 먼저 착한 사람이 되어줘.",
                "그 사람의 무례함은 그 사람의 인격 문제지, 네 잘못이 아니야.",
                "너를 아껴주는 사람만 챙기기에도 인생은 짧아.",
                "상처 주는 말들은 모래 위에 쓴 글씨처럼 파도에 씻겨나가길.",
                "너는 사랑받기 위해 태어난 사람이야. 그 사실을 의심하게 만드는 사람은 멀리해.",
                "억지로 관계를 붙잡으려 하지 마. 네가 편안한 게 제일 중요해.",
                "너의 진심을 몰라주는 사람들 때문에 너무 마음 쓰지 마.",
                "혼자라고 느껴질 때도, 밤바다와 나는 네 편이야."
            ],
            # [상황 3] 미래, 불안, 취업 ("취업", "미래", "돈", "진로", "걱정" 등)
            'future': [
                "지금은 짙은 안개 속에 있는 것 같아도, 걷다 보면 분명 길이 나올 거야.",
                "조급해하지 마. 꽃이 피는 시기는 저마다 다르니까.",
                "너는 너만의 속도로 아주 잘 가고 있어. 남들과 비교하지 마.",
                "지금의 불안은 네가 그만큼 잘하고 싶다는 열정의 증거야.",
                "너무 멀리 보지 마. 그냥 내일 아침 눈 뜨는 것, 그것만 생각하자.",
                "인생은 속도가 아니라 방향이래. 잠시 쉬어가도 괜찮아.",
                "포기하지 않는 한, 실패는 없어. 과정이 있을 뿐이지.",
                "내일은 오늘보다 조금 더 다정한 기회가 찾아올 거야."
            ],
            # [상황 4] 피로, 번아웃 ("힘들다", "지쳐", "피곤", "하기싫어" 등)
            'burnout': [
                "오늘 하루도 버티느라 정말 고생 많았어. 진짜로.",
                "아무것도 안 해도 괜찮아. 존재만으로도 넌 충분히 의미 있어.",
                "지금 너에게 가장 필요한 건 '더 노력하기'가 아니라 '푹 쉬기'야.",
                "배터리가 방전되면 충전을 해야지. 너는 기계가 아니잖아.",
                "마음의 짐을 잠시 내려놔. 오늘은 무거운 거 들지 마.",
                "따뜻한 이불 속이 세상에서 제일 안전한 곳이야. 얼른 들어가.",
                "도망쳐도 돼. 울어도 돼. 오늘만큼은 너한테 관대해지자.",
                "밥은 챙겨 먹었어? 몸이 튼튼해야 마음도 힘을 내지."
            ],
            # [상황 5] 기본/랜덤 (키워드 없을 때 나가는 무난한 문구)
            'general': [
                "괜찮아, 다 지나갈 거야. 이 말 믿고 오늘은 푹 자자.",
                "깜깜한 밤일수록 별은 더 선명하게 빛나는 법이야.",
                "파도가 휩쓸고 간 자리는 금방 다시 깨끗해져. 네 마음도 그럴 거야.",
                "너는 생각보다 훨씬 강한 사람이야. 지금까지 잘 견뎌왔잖아.",
                "내일 아침엔 기분 좋은 햇살이 너를 깨워줄 거야.",
                "비 온 뒤에 땅이 더 굳어지듯, 너는 더 단단해질 거야.",
                "한숨 크게 한 번 쉬고, 이제 그만 생각하자. 뚝.",
                "파도 소리 좋다. 이 소리에 걱정을 다 태워 보내자."
            ]
        }

        # 2. 키워드 검사 (여기가 핵심!)
        user_text = text.replace(" ", "") # 띄어쓰기 무시하고 검사

        # 실수/자책 키워드
        if any(word in user_text for word in ['실수', '망했', '망함', '바보', '멍청', '잘못', '후회', '사고']):
            return random.choice(messages['failure'])
        
        # 인간관계 키워드
        elif any(word in user_text for word in ['사람', '친구', '상사', '싸움', '말', '연락', '이별', '헤어', '짜증']):
            return random.choice(messages['relationship'])
            
        # 미래/불안 키워드
        elif any(word in user_text for word in ['취업', '미래', '돈', '진로', '면접', '합격', '불합격', '시험', '성적']):
            return random.choice(messages['future'])
            
        # 피로/번아웃 키워드
        elif any(word in user_text for word in ['힘들', '지쳐', '피곤', '하기싫', '죽고', '우울', '쉬고', '그만']):
            return random.choice(messages['burnout'])
            
        # 키워드 없으면 -> 그냥 일반 위로
        else:
            return random.choice(messages['general'])


    # ------------------------------------------------------------------
    # [UI 구성]
    # ------------------------------------------------------------------

    # 1. 인트로 멘트
    st.markdown("""
    <div style="text-align: center; color: #495057; line-height: 1.6;">
    마음이 복잡할 땐 탁 트인 바다를 보는 게 최고래.<br>
    여기는 아무도 없는 <b>새벽의 모래사장</b>이야.<br>
    너를 괴롭히는 그 생각을 모래 위에 적어두고 <b>흘려보내자.</b>
    </div>
    <br>
    """, unsafe_allow_html=True)

    # 2. 상태 관리
    if 'worry_status' not in st.session_state:
        st.session_state['worry_status'] = 'input' 

    # [Step 1] 고민 입력
    if st.session_state['worry_status'] == 'input':
        with st.form("worry_form"):
            worry_text = st.text_area(
                "모래사장에 손가락으로 꾹꾹 눌러 써봐.", 
                height=150, 
                placeholder="예: 오늘 발표 완전 망쳤어... 사람들이 다 나만 보는 것 같아."
            )
            submit = st.form_submit_button("🌊 다 썼어. 이제 파도 불러줘.")
            
        if submit:
            if len(worry_text) < 2:
                st.warning("파도가 가져가기엔 너무 가벼운걸? 조금 더 적어봐.")
            else:
                st.session_state['user_worry_text'] = worry_text # 고민 저장 (키워드 분석용)
                st.session_state['worry_status'] = 'burning'
                st.rerun()

    # [Step 2] 파도 연출 (로딩 바)
    elif st.session_state['worry_status'] == 'burning':
        placeholder = st.empty()
        with placeholder.container():
            st.markdown("### 🌊 파도가 밀려오는 중...")
            st.caption("모래 위에 적은 글씨가 지워지고 있어...")
            
            # [핵심] 여기서 고민 내용을 분석해서 메시지를 미리 뽑아둠!
            if 'final_message' not in st.session_state:
                user_worry = st.session_state.get('user_worry_text', "")
                # 스마트 함수 호출!
                st.session_state['final_message'] = get_smart_comfort_message(user_worry)

            progress_bar = st.progress(0)
            for i in range(100):
                time.sleep(0.03) 
                progress_bar.progress(i + 1)
            
            st.success("파도가 네 걱정을 데려갔어.")
            time.sleep(1)
        
        st.session_state['worry_status'] = 'done'
        st.rerun()

    # [Step 3] 보상 (맞춤형 메시지 출력)
    elif st.session_state['worry_status'] == 'done':
        
        message = st.session_state['final_message']

        st.markdown(f"""
        <div style="
            background-color: #e3f2fd; 
            padding: 30px; 
            border-radius: 15px; 
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-top: 20px;
            margin-bottom: 20px;
            color: #495057;">
            <div style="font-size: 2rem; margin-bottom: 10px;">🐚</div>
            <div style="font-size: 1.1rem; font-weight: bold; line-height: 1.6;">
                "{message}"
            </div>
            <div style="font-size: 0.8rem; color: #5c7cfa; margin-top: 15px;">
                - 밤바다가 남기고 간 조개껍데기 -
            </div>
        </div>
        """, unsafe_allow_html=True)
        
        
        col1, col2 = st.columns(2)
        with col1:
            if st.button("🌊 모래사장에 다시 쓰기"):
                # 초기화
                keys_to_clear = ['final_message', 'user_worry_text']
                for key in keys_to_clear:
                    if key in st.session_state:
                        del st.session_state[key]
                st.session_state['worry_status'] = 'input'
                st.rerun()
        with col2:
            st.info("파도 소리 들으니까 좀 편해졌어?")


import streamlit as st
import random
import textwrap # 이 친구가 꼭 필요합니다!

import streamlit as st
import random

# ==============================================
# [메뉴 6] 02:50 꿈나라 체크인 (최종 수정)
# ==============================================
def page_250():
    st.title(" 02:50_꿈나라 체크인")
    st.caption("이제 핸드폰 내려놓고, 진짜 자러 가자.")
    st.markdown("---")

    # 1. 데이터 불러오기
    saju_element = st.session_state.get('saju_result', '별의 여행자') 
    test_animal = st.session_state.get('test_result', '') 
    user_title = f"{saju_element} {test_animal}" if test_animal else saju_element

    # 2. 랜덤 키워드 생성
    adjectives = [
        "폭신폭신한", "따끈따끈한", "고요한", "은은한", "나른한", 
        "포근한", "부드러운", "적당히 시원한", "달콤한", "몽글몽글한",
        "차분한", "조용한", "깨끗한", "안락한", "향기로운",
        "꿈결 같은", "별이 쏟아지는", "깊고 진한", "평화로운", "아늑한"
    ]
    objects = [
        "구름 베개", "수면 양말", "따뜻한 우유", "새벽 달빛", "작은 무드등",
        "자장가", "밤하늘", "솜사탕 이불", "오르골", "꿈 기차",
        "양초", "모닥불", "밤바람", "라벤더 향기", "애착 인형",
        "다락방", "비밀 기지", "밤산책", "은하수", "새벽 별"
    ]
    actions = [
        "이(가) 너를 꿀잠의 세계로 데려갈 거야.",
        "속에서 아무 걱정 없이 푹 자게 될 거야.",
        "을(를) 덮고 내일 아침까지 딥슬립 예약이야.",
        "이(가) 네 꿈속을 예쁘게 꾸며줄 거야.",
        "옆에서 밤새 너를 지켜줄 거야.",
        "을(를) 타고 기분 좋은 꿈여행을 떠날 거야.",
        "이(가) 내일 아침 개운함을 선물할 거야.",
        "속에 오늘의 피로를 다 묻어두고 가.",
        "이(가) 너의 무거운 머리를 비워줄 거야.",
        "과 함께라면 악몽은 얼씬도 못 할 거야."
    ]

    if 'dream_card' not in st.session_state:
        adj = random.choice(adjectives)
        obj = random.choice(objects)
        act = random.choice(actions)
        st.session_state['dream_card'] = f"{adj} {obj}"
        st.session_state['dream_msg'] = act
        st.session_state['ticket_id'] = f"NO.{random.randint(1000, 9999)}"

    # ------------------------------------------------------------------
    # [UI] 티켓 디자인 (여기 수정됨!)
    # ------------------------------------------------------------------
    st.markdown("### 🎫 Boarding Pass : Dreamland")

    # 👇 HTML 코드를 왼쪽 벽에 딱 붙였습니다. (들여쓰기 없음)
    # 이렇게 해야 Markdown이 '코드'로 인식하지 않고 '디자인'으로 인식합니다.
    st.markdown(f"""
<div style="background-color: #2b2d42; border-radius: 10px; padding: 20px; color: #edf2f4; box-shadow: 0 4px 6px rgba(0,0,0,0.3); margin-bottom: 25px;">
    <div style="display: flex; justify-content: space-between; margin-bottom: 15px; font-size: 0.8rem; color: #8d99ae;">
        <span>PASSENGER: {user_title}</span>
        <span>{st.session_state['ticket_id']}</span>
    </div>
    <div style="border-top: 1px dashed #8d99ae; margin-bottom: 20px;"></div>
    <div style="text-align: center;">
        <div style="font-size: 0.9rem; margin-bottom: 5px; color: #8d99ae;">YOUR ITEM</div>
        <div style="font-size: 1.8rem; font-weight: bold; margin-bottom: 15px; color: #fff;">
            ☁️ {st.session_state['dream_card']}
        </div>
        <div style="font-size: 1rem; font-weight: 300; line-height: 1.5;">
            "이 아이템{st.session_state['dream_msg']}"
        </div>
    </div>
    <div style="margin-top: 20px; letter-spacing: 5px; text-align: center; font-size: 0.7rem; color: #5c677d;">
        ||| ||||| || |||| |||| |||
    </div>
</div>
""", unsafe_allow_html=True)

    # 3. 마무리 멘트
    if saju_element == '별의 여행자' and test_animal == '':
        final_comment = "앞의 검사들을 다 하고 오면, 더 정확한 잠자리 처방을 해줄게. (물론 지금도 넌 최고야)"
    else:
        final_comment = f"너는 '{saju_element}'이라 열정이 넘치지만, 속은 '{test_animal}'이라 섬세한 면이 있어. 오늘 하루, 그 두 마음 다독이느라 고생했어."

    st.info(f"💌 {final_comment}")

    st.markdown("<br>", unsafe_allow_html=True)
    if st.button("🛌 폰 끄고 자러 가기 (새로고침)"):
        for key in list(st.session_state.keys()):
            del st.session_state[key]
        st.rerun()
# ==============================================
# [메인 관제탑] 여기가 실행의 시작점입니다!
# ==============================================
def main():
    # 1. 스타일 설정 (CSS)
    st.markdown("""
        <style>
            /* 1. 상단 남색 띠(헤더)를 아예 투명하게 만들어서 배경과 통합 */
            header[data-testid="stHeader"] {
                background-color: rgba(0,0,0,0) !important;
                border-bottom: none !important;
            }

            /* 2. 전체 배경을 완벽한 검정색으로 설정 */
            .stApp {
                background-color: #000000 !important;
            }

            /* 3. ★ 핵심: 사이드바 다시 꺼내기 버튼(>)을 흰색으로 강제 표시 */
            /* 이 코드가 있으면 사이드바를 닫아도 왼쪽 위에 화살표가 선명하게 보입니다 */
            button[data-testid="stSidebarCollapseAction"] {
                color: #ffffff !important;
                background-color: rgba(255, 255, 255, 0.1) !important; /* 살짝 배경색을 줘서 더 잘 보이게 함 */
                border-radius: 50% !important;
            }

            /* 4. 아래쪽 필요없는 푸터(구분선 등) 숨기기 */
            footer {visibility: hidden;}
            #MainMenu {visibility: hidden;}

            /* 5. 본문 영역 상단 여백 (버튼이랑 겹치지 않게) */
            .block-container {
                padding-top: 3.5rem !important;
            }

/* 모바일 레이아웃 강제 교정 (PC와 동일한 구조 구현) */
    @media (max-width: 768px) {
        /* 1. 사이드바 강제 고정 및 너비 축소 (모바일 공간 확보) */
        [data-testid="stSidebar"] {
            transform: none !important;
            visibility: visible !important;
            display: block !important;
            width: 150px !important; /* 목차 너비를 150px로 줄여서 본문 공간 확보 */
            min-width: 150px !important;
            position: fixed !important;
            z-index: 100 !important;
        }

        /* 2. 본문 그릇(Container)을 오른쪽으로 확실히 밀어내기 (겹침 방지 핵심) */
        .main .block-container {
            padding-left: 170px !important; /* 사이드바 너비보다 20px 더 밀기 */
            padding-right: 10px !important;
            max-width: 100% !important;
        }

        /* 3. 상단에 뜨는 ㅈ같은 화살표 텍스트(아이콘 에러) 완전 삭제 */
        [data-testid="collapsedControl"], .st-emotion-cache-1f8u604, header {
            display: none !important;
            height: 0 !important;
        }

        /* 4. 본문 내부 카드 너비가 화면 밖으로 나가지 않게 조절 */
        .report-card {
            width: 100% !important;
            padding: 15px !important;
            margin-left: 0 !important;
        }
    }
        </style>
    """, unsafe_allow_html=True)
    # 2. 사이드바 메뉴 구성 (사용자님이 짠 코드!)
    with st.sidebar:
        st.header("🕰️ 새벽 시간표")
        st.markdown("---")
        
        menu = st.radio(
            "어디로 갈까?",
            [
                "02:00 새벽 2시 상담소",
                "02:10 나의 타고난 기질",
                "02:20 내 마음 현미경",
                "02:30 나를 위한 처방",
                "02:40 밤바다 산책",
                "02:50 꿈나라 체크인"
            ]
        )
        
        st.markdown("---")
        st.caption("From. 꿈 많은 사람")

    # 3. 메뉴 선택에 따른 페이지 이동
    if menu == "02:00 새벽 2시 상담소":
        main_page()
    elif menu == "02:10 나의 타고난 기질":
        page_210()
    elif menu == "02:20 내 마음 현미경":
        page_220()
    elif menu == "02:30 나를 위한 처방":
        page_230()
    elif menu == "02:40 밤바다 산책":
        page_240()
    elif menu == "02:50 꿈나라 체크인":
        page_250()

# 프로그램 실행
if __name__ == "__main__":
    main()